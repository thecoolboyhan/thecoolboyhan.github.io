<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Rust on 韩永发的博客</title><link>https://thecoolboyhan.github.io/categories/rust/</link><description>Recent content in Rust on 韩永发的博客</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Tue, 25 Nov 2025 00:00:00 +0000</lastBuildDate><atom:link href="https://thecoolboyhan.github.io/categories/rust/index.xml" rel="self" type="application/rss+xml"/><item><title>区块链共识简介（BTC、ETH、Solana）</title><link>https://thecoolboyhan.github.io/p/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%85%B1%E8%AF%86%E7%AE%80%E4%BB%8Bbtcethsolana/</link><pubDate>Tue, 25 Nov 2025 00:00:00 +0000</pubDate><guid>https://thecoolboyhan.github.io/p/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%85%B1%E8%AF%86%E7%AE%80%E4%BB%8Bbtcethsolana/</guid><description>&lt;img src="https://thecoolboyhan.github.io/p/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%85%B1%E8%AF%86%E7%AE%80%E4%BB%8Bbtcethsolana/1.png" alt="Featured image of post 区块链共识简介（BTC、ETH、Solana）" /&gt;&lt;h1 id="区块链"&gt;区块链
&lt;/h1&gt;&lt;h2 id="拜占庭将军问题"&gt;拜占庭将军问题
&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;世界上只有一种共识协议，就是Paxos，其他的所有共识算法都是Paxos的退化版本。&lt;/p&gt;
&lt;p&gt;虽然Paxos长久以来一直无敌于分布式共识，但paxos在提出时并不能解决拜占庭将军问题。今天就从区块链的角度了解区块链是如何看待分布式共识，并解决拜占庭问题。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;**没有拜占庭的世界：**信息可能丢失也可能延迟，但不会被错误传递。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;拜占庭将军问题&lt;/strong&gt;：信息可能丢失也可能延迟，&lt;font color='red'&gt;同时有人会故意破坏系统，故意传递错误的信息。&lt;/font&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;即使有恶意参与者也能正常工作&lt;/li&gt;
&lt;li&gt;任何人都可以无需批准的加入&lt;/li&gt;
&lt;li&gt;去中心化：完全分布式，无中心网络&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;font color='red'&gt;比特币提出的方案：&lt;/font&gt;不是试图确定谁值得信任，而是让撒谎在经济上比说真话更昂贵。工作量证明通过要求参与者消耗真实的计算能量来提出更改。攻击者需要在电力上话费的成本远超过他们通过攻击所能获得的收益。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="区块链基础"&gt;区块链基础
&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;对于拜占庭问题，如果有f个叛徒，就至少需要有3f+1个参与者才能保证结果真实性。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id="共识机制"&gt;共识机制
&lt;/h3&gt;&lt;h4 id="传统网络金融的解决方案"&gt;传统网络金融的解决方案
&lt;/h4&gt;&lt;p&gt;4个将军中有一个叛徒。叛徒告诉两个好人进攻，告诉另一个好人撤退。如果只有两个好人进攻。&lt;/p&gt;
&lt;p&gt;此时：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;好人1&lt;/th&gt;
&lt;th&gt;好人2&lt;/th&gt;
&lt;th&gt;好人3&lt;/th&gt;
&lt;th&gt;结果&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;提出：进攻&lt;br /&gt;收到：3进攻&lt;/td&gt;
&lt;td&gt;收到好人1进攻，坏人撤退&lt;/td&gt;
&lt;td&gt;收到好人1进攻，坏人撤退&lt;/td&gt;
&lt;td&gt;好人1误以为全部进攻，但2和3犹豫不觉重新投票&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;确认阶段：好人1 又收到了其他两个好人的犹豫答复&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;无限重试&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;但paxos会导致决定无法确定（有意的创造了活锁），从而无法达成共识。&lt;/p&gt;
&lt;p&gt;传统网络如何解决？&lt;/p&gt;
&lt;p&gt;必须事前知道所有的参与者是谁，且不能丢失。&lt;/p&gt;
&lt;p&gt;每个参与者给其他所有参与者发送相同的消息，此时在根据得到消息的结果来达成共识。&lt;/p&gt;
&lt;p&gt;4个系统就需要，4*3=12次的消息传递，随着系统的增多和意见的不统一，则会更加可能出现问题。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;网络通讯次数多，随着参与者的增多，达成共识的可能变成几乎不可能。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id="工作量证明pow"&gt;工作量证明（POW）
&lt;/h4&gt;&lt;p&gt;每个人想要得到自己的结论，必须进行一个昂贵的计算工作&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;矿工将待记账（确认收货）的交易收集到一个区块中&lt;/li&gt;
&lt;li&gt;旷工必须找到一个随机数，和当前区块数据结合并进行hash运算，产生一个特殊（多个零开头）的结果&lt;/li&gt;
&lt;li&gt;第一个找到答案的旷工将其方案广播到网络&lt;/li&gt;
&lt;li&gt;其他参与者立刻验证解决方案的正确性并开始接收下一个新的区块（上一个区块确认收货，记账成功）下一个新区块的头包含上一次的hash值&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;尝试用pow模拟拜占庭问题&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;先看上面的场景，假设4个将军，1个叛徒&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;由于工作量是概率问题，4个将军每个人记账成功的概率为25%，则目前好人算力为3，坏人算力为1&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;pow默认大家都是无限工作的，链是无限延伸的。&lt;/p&gt;
&lt;p&gt;叛徒的任务是改变一个已经记账成功的区块。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://fastly.jsdelivr.net/gh/thecoolboyhan/th_blogs@main/image/2025-11/1763713085384_1763713091538.png"
loading="lazy"
alt="1763713085384.png"
&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;假设每个人单位时间内算计为1，坏人需要在3个好人记录为区块2时完成区块1.1,2.1才能让新加入的参与者以坏人链为开始。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;好人完成区块2需要的算力&lt;/strong&gt;：3&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;坏人超过区块2需要的算力&lt;/strong&gt;：6（3个算力负责完成1.1,3个算力负责完成2.1）+1&lt;/p&gt;
&lt;p&gt;坏人如果想要篡改一个区块，则知道需要2*好人数+1的算力&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;font color='red'&gt;篡改并不意味着不可能，只是至少需要掌握2*好人数+1的算力（成本高）&lt;/font&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;篡改一个的成本如此，如果想要篡改更早的区块，难度几乎不可能，比特币白皮书中关于改账成本的估算：&lt;/p&gt;
&lt;p&gt;&lt;img src="https://fastly.jsdelivr.net/gh/thecoolboyhan/th_blogs@main/image/2025-11/1763714740053_1763714750245.png"
loading="lazy"
alt="1763714740053.png"
&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;记账成本&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;如果采用pow模式记账，那对于一个旷工来说记账成功需要成本是多少？&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;计算成本&lt;/strong&gt;：求出hash值需要大量的本地计算（本次计算都发生在本地，只要有一个旷工为区块内求出hash值），只需要此随机值广播的网络&lt;/p&gt;
&lt;p&gt;**网络传输成本：**计算出hash值的旷工需把hash值广播到互联网，不需要关注接受者和接收情况，也不用关心其他旷工是否认可本结果。&lt;/p&gt;
&lt;p&gt;**出错概率与容错：**由于网络原因，可能会存在部分旷工错认为一部分已经过时的节点为最新节点。但当其正常接入互联网后，会立刻发现最新的链，并连接上新链。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;font color='red'&gt;总体看来记账成本为固定一个区块的算计成本，不会由于接入旷工的多少而影响记账成本。&lt;/font&gt;&lt;/p&gt;
&lt;p&gt;&lt;font color='red'&gt;准确性为可能由于网络原因，导致新记录的部分区块账务不准确，但随着区块的增多，出错概率越来越小。且篡改可能几乎为0&lt;/font&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id="权益证明proof-of-stakepos"&gt;权益证明（Proof of Stake）POS
&lt;/h4&gt;&lt;p&gt;参与者抵押自己的资金&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;参与者抵押的虚拟货币将被锁定&lt;/li&gt;
&lt;li&gt;随机选择一个验证者提交新的区块&lt;/li&gt;
&lt;li&gt;其他的验证者投票选择接受或者拒绝&lt;/li&gt;
&lt;li&gt;诚实的行为（多数派）获得奖励，篡改者将会受到惩罚（减少一部分抵押的虚拟货币）&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;与pow相比，记账成功的确定被提前了，一个区块只要大多数验证者确认后。如果攻击者想要篡改他，需要的成本将高的无法承受。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id="区块链三难问题"&gt;区块链三难问题
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;安全性：抵抗攻击和审查的能力&lt;/li&gt;
&lt;li&gt;可扩展性：高交易吞吐量&lt;/li&gt;
&lt;li&gt;去中心化：没有单一节点&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;比特币选择了&lt;strong&gt;安全性和去中心化&lt;/strong&gt;，而不是扩展性。由于篡改成本过高，保留安全性，由于是完全去中心化的设计，不会由于单个节点的下线导致账务数据丢失。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;不可扩展（个人认为不具备伸缩性）&lt;/strong&gt;：由于理论单个区块记账的算力是固定的，不会由于增了多台机器到让一个区块的记账成本变低。每台机器的添加都需要经过区块计算（只是计算出的概率高低问题）。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;从极端场景考虑，每个区块记录的账务数量固定，单位算力算出的区块固定，如果交易量过大，需要等待多个区块后才能加入记账。区块的产生速度不会随着交易数量的变多而变快。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id="加密方式"&gt;加密方式
&lt;/h3&gt;&lt;p&gt;区块链主要依赖三种关键的密码学工具，来创建一个不可篡改且可验证的系统。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;旷工得出不可篡改的结果，其他旷工验证此结果的正确性。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id="哈希函数数据连贯性"&gt;哈希函数（数据连贯性）
&lt;/h4&gt;&lt;blockquote&gt;
&lt;p&gt;hash函数可以把任何输入，转换成固定大小额输出。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;确定性：相同的输入总是会产生相同的输出&lt;/li&gt;
&lt;li&gt;不可逆性：该函数在一个方向上易于计算，但反方向计算几乎不可能。给定一个hash值，无法轻易的找到原始值。（需要暴力破解和查表）简称二极管&lt;/li&gt;
&lt;li&gt;雪崩效应：输入的微小变化会导致完全不同的输出hashCode&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;SHA-256(&amp;#34;Hello&amp;#34;) = 185f8db32271fe25f561a6fc938b2e264306ec304eda518007d1764826381969
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;SHA-256(&amp;#34;hello&amp;#34;) = 2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;区块链中，hash值用来确保数据的完整性。每个区块都包含前一个区块的hash值，从而形成一个不可破坏的链条。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;一个记录了上一个节点的hash值的双向链表，如果想要修改链中的某个节点。后续所有的节点都需要做出修改。从实现难度上讲，&lt;strong&gt;这几乎是不可能的&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id="数字签名保证数据真实"&gt;数字签名（保证数据真实）
&lt;/h4&gt;&lt;blockquote&gt;
&lt;p&gt;传统金融的身份验证依赖于共享的秘密信息（密码、声纹，指纹等都需要统一且值得信赖的第三方）。但区块链在没有可信机构或安全渠道来共享秘密信息的情况下运行。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;数字签名使用了非对称加密技术：在一个方向上计算很容易，但几乎不可能反向计算。当创建一个数字签名时，会生成两个数学相关的数字，一个私钥，一个公钥，私钥必须保密，而公钥可以自由共享。&lt;/p&gt;
&lt;p&gt;加密步骤：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;签名创建&lt;/strong&gt;：私钥为交易创建数字签名。&lt;/li&gt;
&lt;li&gt;签名是私钥和交易内容的唯一组合。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;签名验证&lt;/strong&gt;：任何人都可以使用公钥来验证，但签名只能由拥有相应私钥的人创建。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;防盗&lt;/strong&gt;：没有私钥的人，即使拥有之前所有私钥产生的签名，也无法算出新的有效签名。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;防重放&lt;/strong&gt;：每个签名都必须包含一段唯一的随机数，以确保每个签名都是唯一的。&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="默克尔树merkle-tree数据存储"&gt;默克尔树Merkle Tree（数据存储）
&lt;/h4&gt;&lt;p&gt;&lt;img src="https://fastly.jsdelivr.net/gh/thecoolboyhan/th_blogs@main/image/2025-11/1763966497460_1763966497475.png"
loading="lazy"
alt="1763966497460.png"
&gt;&lt;/p&gt;
&lt;p&gt;每个叶子节点表示一笔交易，每个父节点都包含两个叶子节点的hash值。需要验证某个叶子节点，对于其他的节点，只需要保存其他兄弟节点的hash值，和需要验证节点的真实值。&lt;/p&gt;
&lt;p&gt;图中展示了验证交易3，只需要下载交易3的值和路径上的hash值即可。由于层层hash，保证了整体数据的完整性。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;每次做数据验证，只需要按照层高来验证数据。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id="总结"&gt;总结
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;hash确保历史数据无法被篡改。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;数字签名保证数据真实&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;默克尔树使无需下载大量数据即可验证复杂的数据。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="区块链的演变"&gt;区块链的演变
&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;上面是区块链的基础知识，可目前区块链已经是一个可编程区块链平台。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id="比特币bitcoin"&gt;比特币（Bitcoin）
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;比特币的创建目的&lt;/strong&gt;：创建一种无需银行或政府运作的数字货币。&lt;/p&gt;
&lt;h4 id="共识机制-1"&gt;共识机制
&lt;/h4&gt;&lt;p&gt;比特币使用了中本聪的原始工作量证明（POW Proof of Work）实现。旷工们竞争寻找一个随机数（nonce），当与区块数据一起hash时，会生成一个以特定数量的0开头的hash值。&lt;/p&gt;
&lt;p&gt;网络每隔2016个区块（大约两周）会自动调整难度，以保持平均区块时间为10分钟。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;如果区块生成速度快&lt;/strong&gt;：会导致网络分裂，大量旷工在不同的区块版本上工作。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;如果区块慢&lt;/strong&gt;：交易速度会随着变慢。（确保一笔交易成功，最好等主链向后足够长）&lt;/p&gt;
&lt;h4 id="utxo模型资金管理"&gt;UTXO模型（资金管理）
&lt;/h4&gt;&lt;p&gt;比特币不像银行那样追踪账户余额。它通过UTXO（未花费交易输出）来追踪单个“币”。（类似于实体现金）&lt;/p&gt;
&lt;p&gt;&lt;img src="https://fastly.jsdelivr.net/gh/thecoolboyhan/th_blogs@main/image/2025-11/1763967976150_1763967976191.png"
loading="lazy"
alt="1763967976150.png"
&gt;&lt;/p&gt;
&lt;p&gt;Alice的初始拥有来自三个不同人的BTC。Alice共拥有1.6BTC，但并没有一个账户存储这个数字。相反，区块链记录了Alice可以使用三个独立的UTXO。&lt;/p&gt;
&lt;p&gt;现在Alice想要给Eve发送1.0BTC：&lt;/p&gt;
&lt;p&gt;由于Alice没有单个UTXO的余额达到1.0BTC，所以他选择了UTXO#1和#3共计1.3BTC来进行这笔交易。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://fastly.jsdelivr.net/gh/thecoolboyhan/th_blogs@main/image/2025-11/1763968497019_1763968497051.png"
loading="lazy"
alt="1763968497019.png"
&gt;&lt;/p&gt;
&lt;p&gt;交易如图所示来表示，这里为了简单，按照UTXO的图表示变化。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://fastly.jsdelivr.net/gh/thecoolboyhan/th_blogs@main/image/2025-11/1763969586890_1763969586922.png"
loading="lazy"
alt="1763969586890.png"
&gt;&lt;/p&gt;
&lt;p&gt;Alice的UTXO#1和#3被使用，此时Eve得到来自Alice的1.0BTC（UTXO#4），Alice得到来自Alice的0.3BTC（UTXO#5）。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://fastly.jsdelivr.net/gh/thecoolboyhan/th_blogs@main/image/2025-11/1763969876745_1763969876784.png"
loading="lazy"
alt="1763969876745.png"
&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;两人最终钱包的变化情况，&lt;font color='red'&gt;本次交易和上图一起完成，实现了一笔交易。&lt;/font&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;UTXO（交易输出）的优点&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;并行处理&lt;/strong&gt;：每个UTXO只能被花费一次，不同的UTXO的交易不会发生冲突。旷工可以同时验证数千笔交易，只要每笔交易引用的UTXO不同，就无需担心重复消费。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;隐私&lt;/strong&gt;：没有一个全局账户显示总余额。你的BTC分散在多个UTXO中，很难获取到你名下共有多少BTC。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;简单验证&lt;/strong&gt;：每笔交易可以通过独立验证输入的UTXO是否存在且未被花费，以及数字签名的有效性来完成。无需维护账户状态，也无需担心交易顺序对余额的影响。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;原子操作&lt;/strong&gt;：交易要么全部完成，要么完全失败。（消耗的UTXO和新产生的UTXO一起）不存在资金被扣除但未转移的情况。&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="以太坊ethereum"&gt;以太坊（Ethereum）
&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;如果区块链可以转账，是否可以运行程序？&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;第一个通用的区块链计算机。&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id="共识机制-2"&gt;共识机制
&lt;/h4&gt;&lt;p&gt;采用权益证明（POS Proof of work），以抵押担保方式来承诺支付。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;数学极限：大约13分钟后，交易在数学上变得不可逆。&lt;/li&gt;
&lt;li&gt;能源节省：不再需要大量的算力算出随机数。&lt;/li&gt;
&lt;li&gt;未来升级：权益证明支持分片，将网络分成并行链来提高吞吐量。（可以增加单位时间内记账成功的交易数量）&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="账务模型"&gt;账务模型
&lt;/h4&gt;&lt;blockquote&gt;
&lt;p&gt;采用了基于账户的余额系统取代了BTC的UTXO系统。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;智能合约：驻留在链上的程序，能够维护自己的状态&lt;/li&gt;
&lt;li&gt;外部账户：类似于BTC地址的用户控制账户&lt;/li&gt;
&lt;li&gt;合约间调用：每个智能合约可以无缝地相互交互&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;以太坊的账户主要分两类：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;外部拥有账户（EOA）&lt;/strong&gt;：有用户私钥控制，类似于BTC的地址。它们有余额并可以发送交易。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;合约账户&lt;/strong&gt;：由代码控制，而非私钥。它们既有余额，也存储可执行代码和持久数据。&lt;/p&gt;
&lt;p&gt;智能合约是驻留在区块链上的自治程序，能够维护自己的状态，并可以被其他账户调用。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;这些都依赖于以太坊虚拟机（EVM），它运行在每个节点上，使区块链具有可编程性。EVM定义了可以运行的程序、它们的执行方式以及它们消耗的资源。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id="索拉那solana"&gt;索拉那（Solana）
&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;以太坊的升级版&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id="共识机制-3"&gt;共识机制
&lt;/h4&gt;&lt;p&gt;solana在现有的POS权益证明机制上，增加了历史证明（Proof of History）。solana不需要等待事件发生时间的共识，而是创建一个加密时钟，在共识前为所有交易加上时间戳，使验证者可以并行处理交易，因为他们已经知道正确的顺序。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Solana每400毫秒生成一个区块，而以太坊需要12秒。BTC需要10分钟。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id="solana虚拟机svm"&gt;Solana虚拟机（SVM）
&lt;/h4&gt;&lt;p&gt;EVM按顺序处理交易，因为智能合约共享全局状态，一个合约修改共享数据，所有其他的交易必须等待。&lt;/p&gt;
&lt;p&gt;Solana的设计：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;无状态程序&lt;/strong&gt;：以太坊智能合约内部存储数据，Solana的程序无状态。所有数据存储在独立的账户中，程序从中读取和写入。这种分离使得并行处理成为可能。（多笔交易之间不需要争抢锁）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;交易并行处理&lt;/strong&gt;：Solana的交易必须提前声明将读取和修改哪些账户。运行时可以同时在多个CPU核心上执行不冲突的交易。如果交易A修改账户X，而交易B修改账户Y，它们可以并行运行。（本质上对于单个账户还是串行处理，多个线程操作的账户完全隔离）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;优化执行&lt;/strong&gt;：SVM使用基于寄存器的架构，而不是EVM基于堆栈的方式，从而减少了计算过程中的数据复制和移动，程序编译为本地汇编，而不是字节码，消除了编译的开销。（有点牵强）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;可预测的成本&lt;/strong&gt;：和以太坊多年前确定的固定Gas价格不同，Solana使用了动态费用市场，交易成本反映了实际的网络需求和消耗的计算资源。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="solana简介"&gt;Solana简介
&lt;/h2&gt;&lt;h3 id="账户"&gt;账户
&lt;/h3&gt;&lt;p&gt;存储在区块链上的数据容器。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;span class="lnt"&gt;19
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-rust" data-lang="rust"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;pub&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;struct&lt;/span&gt; &lt;span class="nc"&gt;Account&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="sd"&gt;/// lamports in the account
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="sd"&gt;/// 该账户的lamports
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;pub&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lamports&lt;/span&gt;: &lt;span class="kt"&gt;u64&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="sd"&gt;/// data held in this account
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="sd"&gt;///账户中拥有的数据
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="cp"&gt;#[cfg_attr(feature = &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;serde&amp;#34;&lt;/span&gt;&lt;span class="cp"&gt;, serde(with = &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;serde_bytes&amp;#34;&lt;/span&gt;&lt;span class="cp"&gt;))]&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;pub&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;: &lt;span class="nb"&gt;Vec&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;u8&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="sd"&gt;/// the program that owns this account. If executable, the program that loads this account.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="sd"&gt;///拥有该账户的程序，如果执行程序，程序加载该账户
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;pub&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;owner&lt;/span&gt;: &lt;span class="nc"&gt;Pubkey&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="sd"&gt;///
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="sd"&gt;/// this account&amp;#39;s data contains a loaded program (and is now read-only)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="sd"&gt;/// 该账户的数据包含已加载的程序（现在为只读）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;pub&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;executable&lt;/span&gt;: &lt;span class="kt"&gt;bool&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="sd"&gt;/// the epoch at which this account will next owe rent
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="sd"&gt;/// 该账户将要在下一个 epoch 支付租金的 epoch
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;pub&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;rent_epoch&lt;/span&gt;: &lt;span class="nc"&gt;Epoch&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;每个账户都拥有一个唯一的32字节地址（如：14grJpemFaf88c8tiVb77W7TYg2W3ir6pfkKz3YjhhZ5）。此地址是账户在区块链上的标识符，用来定位特定的数据。&lt;/p&gt;
&lt;p&gt;每个账户可以存储10M的数据，这些数据为可执行的程序代码或者特定程序的数据。&lt;/p&gt;
&lt;p&gt;所有账户都需要根据其数据大小存入一定数量的lamport押金以达到“免租”状态。&lt;/p&gt;
&lt;p&gt;每个账户都由一个程序拥有，只有拥有程序可以修改账户的数据或提取其lamport。&lt;/p&gt;
&lt;h4 id="账户类型"&gt;账户类型
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;系统账户&lt;/strong&gt;：存储lamports（SOL的最小单位）并由系统程序拥有。这些账户是基本的钱包账户，用户可以直接与其交互来发送和接收SOL。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;代币账户&lt;/strong&gt;：用来存储SPL代币信息，包含所有权和代币元数据。这些账户由代币程序拥有，并管理Solana生态系统中的所有代币相关操作。&lt;font color='red'&gt;代币账户属于数据账户&lt;/font&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;数据账户&lt;/strong&gt;：存储特定应用程序的信息，并由自定义程序拥有，这些账户保存应用程序的状态。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;程序账户&lt;/strong&gt;：包含在Solana上运行的可执行代码，也就是只能合约所在的位置。这些账户被标记为executable: true，存储处理指令和管理状态的程序逻辑。&lt;/p&gt;
&lt;h4 id="使用账户数据"&gt;使用账户数据
&lt;/h4&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;span class="lnt"&gt;19
&lt;/span&gt;&lt;span class="lnt"&gt;20
&lt;/span&gt;&lt;span class="lnt"&gt;21
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-rust" data-lang="rust"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cp"&gt;#[derive(BorshSerialize, BorshDeserialize)]&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;pub&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;struct&lt;/span&gt; &lt;span class="nc"&gt;UserAccount&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;pub&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;: &lt;span class="nb"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;pub&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;balance&lt;/span&gt;: &lt;span class="kt"&gt;u64&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;pub&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;posts&lt;/span&gt;: &lt;span class="nb"&gt;Vec&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;u32&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;pub&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;fn&lt;/span&gt; &lt;span class="nf"&gt;update_user_data&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;accounts&lt;/span&gt;: &lt;span class="kp"&gt;&amp;amp;&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;AccountInfo&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;new_name&lt;/span&gt;: &lt;span class="nb"&gt;String&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-&amp;gt; &lt;span class="nc"&gt;ProgramResult&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;let&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user_account&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;accounts&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// Deserialize existing data，反序列化
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;let&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;mut&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user_data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;UserAccount&lt;/span&gt;::&lt;span class="n"&gt;try_from_slice&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;user_account&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;borrow&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="o"&gt;?&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// Modify the data，修改用户数据
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user_data&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;new_name&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// Serialize back to account，序列化数据
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user_data&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;serialize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="k"&gt;mut&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="k"&gt;mut&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user_account&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;borrow_mut&lt;/span&gt;&lt;span class="p"&gt;()[&lt;/span&gt;&lt;span class="o"&gt;..&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;span class="o"&gt;?&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;Ok&lt;/span&gt;&lt;span class="p"&gt;(())&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id="交易"&gt;交易
&lt;/h3&gt;&lt;p&gt;Solana的交易是原子操作，可以有多个指令，要么全部成功，要么全部失败。&lt;/p&gt;
&lt;p&gt;一笔交易包含：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;指令&lt;/strong&gt;：要执行的单个操作&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;账户&lt;/strong&gt;：每个指令要读取或写入特定的账户&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;签名者&lt;/strong&gt;：授权交易的账户&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-rust" data-lang="rust"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;Transaction&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;instructions&lt;/span&gt;: &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// Instruction 1: Transfer SOL，指令1：转账
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;system_program&lt;/span&gt;::&lt;span class="n"&gt;transfer&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;from_wallet&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;to_wallet&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;amount&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// Instruction 2: Update user profile ，指令2更新用户资料
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;my_program&lt;/span&gt;::&lt;span class="n"&gt;update_profile&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user_account&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;new_name&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// Instruction 3: Log activity，指令3：记录本次交易日志
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;my_program&lt;/span&gt;::&lt;span class="n"&gt;log_activity&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;activity_account&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;transfer&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;amount&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="sd"&gt;/// 账户，操作的账户，来源账户，目标账户，用户资料账户，日志记录账户
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;accounts&lt;/span&gt;: &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;from_wallet&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;to_wallet&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user_account&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;activity_account&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="sd"&gt;///授权的账户
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;signers&lt;/span&gt;: &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;user_keypair&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h4 id="交易要求和费用"&gt;交易要求和费用
&lt;/h4&gt;&lt;blockquote&gt;
&lt;p&gt;每次交易总大小最大为1232字节，限制了可以执行的指令和账户的数量。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;每个指令都需要包含：要调用的程序地址、指令将读取和写入的所有账户，以及任何附加的数据。&lt;/p&gt;
&lt;p&gt;指令会按照交易中指定的顺序依次执行。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;手续费&lt;/strong&gt;：每笔交易需每个签名5000lamports的基础费用。（用来补偿验证者处理交易）&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;可以额外支付优先费用，来提交本次交易的验证的优先级。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id="solana上的程序"&gt;Solana上的程序
&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;Solana上的程序本身是无状态的，这意味着它们在函数调用之间不维护任何内部状态。他们接收账户作为输入，然后把处理后的结果写入到账户中。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;程序代码保存在 标记为&lt;em&gt;executable: true&lt;/em&gt;的特殊账户中，其中包含了在调用执行时的已经编译的二进制代码。&lt;/p&gt;</description></item></channel></rss>