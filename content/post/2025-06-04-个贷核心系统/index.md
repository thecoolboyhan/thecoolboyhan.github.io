---
title:  个贷核心系统业务概览
date: 2025-06-04
#image: 2025-05-29.png
categories: [金融,精选]
tags: [业务,随笔]
---



## 业务概览

- 授信
- 放款
- 还款



### 主要业务

>  授信、绑卡、放款、还款、债务重组、不规则还款、延展期、诉讼回款、柜面还款、LPR利率浮动、核销、代偿、机构撤并、管护移交、批量扣款、代偿后还款、日终账务、短信通知、记账机构管理、额度管理、客户信息管理、借据管理、贷款凭证管理、合同管理、核心产品管理、LPR利率维护、银行核心模式、助贷模式、税价分离...





## 联机业务

> 授信维护、绑卡维护、客户基础信息维护、合同维护、管护机构及记账机构维护、放款、还款、借据信息维护等



### 授信

授信是业务开始，只有授信后才能开始贷款。



- 额度：客户在一定时间内能够申请贷款的最高金额
- 业务：变更、冻结、解冻、额度占用、恢复、失效、注销
- 额度类型：循环额度、一次性额度、一次性多次使用额度



### 账户

- 账户：他行卡与本行卡的鉴权、绑定、解绑，用于客户收款和还款

- 鉴权：为了确保用户的真实性和支付的安全性，一般是四要素鉴权

### 放款

- 预防款：完成产品，额度等校验，生成借据号等关键信息。
- 放款确认：再次校验产品、额度等信息，完成额度占用，生成借据、期供等基本信息
- 支付放款：调用支付，完成放款（标准放款、受托支付）
- 核算记账：放款成功后，异步通知会计核算记账



### 还款

- 正常还款：借据到期后的还款
- 提前还款：提前N天还当期
- 提前还N期：缩期，每期本金不变，总期数减少
- 提前还部分：摊薄，每期本金减少，总期数不变



### 其他概念

- 期供：每个借据都有对应的期供，期供记录了每一期还款的本金、利息、开始日、到期日期等。
- 还款方式：等额本金、等额本息、先息后本、一次性还本付息，周期性还本付息，气球贷，不规则还款。
- 利率：正常利率，罚息利率，复息利率
- 优惠券：N天免息券、利率折扣券、N期免息券、固定利率券、利息抵扣券
- 还款日：固定还款日、范围随机还款日、最大还款日、还款日间隔





## 批量任务

> 各种流水状态同步、批量、代偿、银行核心模式行内数据拉取等



### 批量扣款

> 客户借据到期后，每日执行的扣款任务



#### 流程

1. 任务生成：按商户、数据库节点、时间点、支付通道等生成批扣
2. 数据载入：按生成的不同批扣任务，载入对应的需要批扣的数据
3. 执行扣款：按人加产品维度，结合还款账户生成扣款记录，发起扣款
4. 短信发送：客户所有借据扣款完成后，按人维度发送扣款结果短信



#### 业务规则

- 扣款时间

  批扣时间点支持配置，配置三次时间 8、16、20点批扣

- 并发控制

  涉及部分特殊支付渠道的扣款，批扣可以设置不同的并发数量控制

- 扣款账户

  扣款账户的顺序是按照产品维度配置的，主流扣款顺序：自有虚账户-->行内虚账户--> 本行卡--> 他行卡

- 余额查询

  扣款前会查询余额，如果余额不足，按可用余额扣款

- 批扣短信

  扣款完成后，准实时发送扣款短信

  

### 借据代偿

> 借据人无法按时偿还贷款时，由担保人或保险公司等第三方代为偿还的业务



#### 业务流程

1. 代偿试算：命中代偿规则的借据，进行代偿试算，生成代偿明细
2. 申请文件：根据代偿明细，生成批量代偿申请文件，上传OSS
3. 文件通知：申请文件上传完成后，通过支付通知行内代偿申请已提交
4. 审批结果：批量代偿审批文件下载、解析、更新审批状态：通过或拒绝，审批通过的借据，会发起代偿还款
5. 代偿结果：代偿完成后，生成代偿结果文件，上传



#### 业务规则

- 代偿天数

  只借据的逾期天数，分为单期代偿天数、整笔代偿天数

- 代偿方式

  单期代偿：单期天数控制，单期做代偿

  整笔代偿：由整笔借据逾期天数控制，做整笔借据代偿

- 账户管理

  按渠道配置代偿账户，或在借据放款时指定代偿账户

- 文件同步

  还款预估文件、代偿申请文件、代偿审批文件、代偿结果文件的同步



### 借据核销

> 核销后贷款从资产负债表中剔除，相关坏账不计入当期损益



#### 业务流程

1. 商户校验：商户是否支持核销，减值核销或非减值核销，核销时是否检查计提
2. 产品校验：产品是否支持核销，核销贷款余额，核销逾期天数是否满足要求
3. 借据校验：借据状态是否正常，是否处理中，是否做过资产剥离，是否已经核销，贷款余额，逾期天数是否满足条件，最大逾期天数内是否有成功还款记录

#### 业务规则





## 日终任务

> 计提、结息、转列、拨备、计税



### 业务流程

1. 日切前：根据日切时间点，拦截前后10分钟的所有交易
2. 日切中-交易拦截：拦截掉除放款外，其他影响账务的交易
3. 日切中-核心：执行计提、结息、转列、拨备，生成对应文件通知会计核系统处理
4. 日切中-会计核算：处理核心系统计提、结息、转列、拨备等文件
5. 日切中-ODS：待核心系统及会计核算系统数据处理完成后，通知ODS抽数
6. 日间：ODS完成供数后，通知核心切日间，继续处理被阻塞的还款交易，当日零金额还款的业务。



### 业务规则

- 计提

  对当天应收客户的贷款利息进行计算，体现银行的贷款利息收入

- 结息

  按约定的时间从客户账扣收贷款利息，体现银行和借据人之间的利息结算

- 转列

  处理贷款借据的四级分类：正常、逾期、呆滞、呆账

- 拨备

  贷款减值准备，拨备金额主要根据贷款的五级分类来确定


## 总结


![业务流程](业务流程.jpg)


![借据的生命周期](借据的生命周期.jpg)



## 贷款

由于各个银行情况不同，有些并不使用本核心做放款、还款等操作。银行为核心的产品本系统只需路由到对应的银行请求行内接口，获取结果。



- 具体的路由方式

目前有两种路由方式：

1. 通过产品号来路由（优先）：通过银行（租户）+产品的维度请求对应的接口
2. 通过银行路由：有些银行只有一个统一的请求接口，无需区分产品。



> 银行相关的配置信息，统一放入路由配置表，通过请求中的产品号获取对应的规则。



> 接下来的所有流程为自有核心流程

### 贷款试算

> 放款提现请的准备重要规则，预生成还款计划、计划利息、借据信息等。



##### 前期准备



- 首次还款日

后续期供信息需要根据首次还款日，来向后累计。在交给计算器来生成期供之前，需要先准备好首次还款日。

> 所有产品的首次还款日默认不许超过28（不许出现29、30、31等）



| 类型               | 结果                                                         |
| ------------------ | ------------------------------------------------------------ |
| 固定还款日         | 每月都使用固定还款日期来还款                                 |
| 固定还款日（下月） | 小于等于固定还款日：使用下月固定还款日<br />大于固定还款日：使用下下月固定还款日 |
| 随机【1,10】       | 1到10号随机一天                                              |
| 随机【11,20】      | 11到20号随机一天                                             |
| 随机【21,28】      | 21到28号随机一天                                             |

> 如果客户信息中，曾记录过用户的还款日，尽量使用相同的还款日。（方便合并批扣）



- 获取利率（授信协议）

从授信协议分项中查出授信时风险模型提供的客户贷款利率。



##### 试算

> 通过首次还款日、利率信息。来预生成还款计划和借据信息

信贷核心执行过程均采用责任链模式，每一步时都会判断是否继续向后执行，无论中间哪一环出现问题直接让流程失败。



- 试算物料初始化

  贷款开始日期、产品信息、优惠券信息



- 使用原始利率试算（折前利率）

根据还款方式来选择试算器



> 不同还款方式的试算器

| 还款方式                   | 试算器               |
| -------------------------- | -------------------- |
| 先息后本                   | 等额本金计算器       |
| 等额本息                   | 等额本息计算器       |
| 等额本金                   | 等额本金计算器       |
| 自定义周期性还本还息       | 等额本金计算器       |
| 气球贷等额本息             | 气球贷等额本息计算器 |
| 气球贷等额本金             | 气球贷等额本金计算器 |
| 气球贷自定义周期性还本还息 | 气球贷等额本金计算器 |

> 各计算器计算方式后文详解

通过试算器试算出：

本息总金额、利息、下次还款日、到期日、还款明细、还款期数



通过试算器得出的为折前利率，但未使用优惠，需要对总金额和利息使用优惠券（优惠券为负值）

**当期初始利息=剩余本金\*年利率\*计息天数（距离放款的天数）/年计息规则天数（360或365）**



> 目前已知的情报：
>
> 1、贷款开始日期、产品信息、优惠券信息
>
> 2、折前：本息总金额、利息、下次还款日、到期日、还款明细、还款期数



- 折后利率计算

> 返回折后利率

优惠后金额需要通过折扣利率来计算，优惠有两种

1. 利率折扣：**折后利率=正常利率\*折扣率**
1. 利息优惠券：**折后利率=（（折前总利息-|优惠券固定优惠利息金额|）/折前总利息**



> 目前已知的情报：
>
> 1、贷款开始日期、产品信息、优惠券信息
>
> 2、折前：本息总金额、利息、下次还款日、到期日、还款明细、还款期数
>
> 3、折后利率



- 通过折后利率在进行一次试算

上一步中得出折后利率，利用折后利率在进行一次试算，就可得出优惠后的利息情况。

> 目前已知的情报：
>
> 1、贷款开始日期、产品信息、优惠券信息
>
> 2、折前：本息总金额、利息、下次还款日、到期日、还款明细、还款期数
>
> 3、折后利率
>
> 4、折后：本息总金额、利息、下次还款日、到期日、还款明细、还款期数



- 试算出每期优惠的金额

通过优惠试算器试算出每期优惠的金额

| 优惠方式                                                     | 试算器         |
| ------------------------------------------------------------ | -------------- |
| 放款使用（折后利息计算还款计划+折扣不提（初始就是折后利息）+回收补提） | 放款优惠试算器 |
| 放款使用（折后利息计算还款计划+折扣不提（初始就是折后利息）+回收补提 等额本息使用优惠券） | 放款优惠试算器 |
| 还款使用（折前利息计算还款计划+折扣反提+回收补提）（默认试算器） | 还款优惠试算器 |
| 还款使用（折前利息计算还款计划+折扣反提+回收补提 等额本息）  | 还款优惠试算器 |



- 费用计算

按出资比率或约定费用计算出所需费用





##### 试算总结

通过以下信息试算出期供明细+借据

1. 试算物料初始化：贷款开始日期、产品信息、优惠券信息
2. 使用原始利率试算（折前利率）：本息总金额（折前）、利息（折前）、下次还款日、到期日、还款明细、还款期数
3. 折后利率计算：折后利率
4. 用折后利率试算：本息总金额（折后）、利息（折后）、下次还款日、到期日、还款明细、还款期数
5. 抵扣金额：每期优惠金额
6. 费用计算：根据规则计算出费用



- 放款试算必须的条件：

产品信息、放款金额、从授信中获取的利率、期数、还款周期、放款日期、优惠方式。



### 放款（TCC）

 

#### 无事务前期准备

- 生成唯一流水

为了防止重复放款，先生成一条唯一交易流水，插入唯一交易流水表（放款、还款同表）。通过唯一约束的交易流水，防重放。

- 查询产品信息

通过请求参数，查询本次贷款产品信息。



#### 额度占用+预开户（事务1：try）

开启事务Transactional

- 获取客户额度与额度协议分项(事务1.1)

校验还款方式、末期本金比例是否合规等

> 目前已有：额度信息（未被占用）、协议信息



- 计算还款日(事务1.1)

根据入参计算还款日，校验卡信息

> 目前已有：
>
> 1、额度信息（未被占用）、协议信息
>
> 2、还款日

- 查询（客户+产品）名下所有的申请信息（成功+处理中的）(事务1.1)

在本次放款记录落库前，先查询一遍申请信息



- 真正的放款try(事务1.1)

> 利率抉择、额度占用、登记流水

1. 校验客户信息(事务1.1)

判断客户是否可以再借款等

2. 抉择利率（开启一个新事务1.2）

> Q如何在一个事务中同一个bean内的方法调用，开启一个新事务？
>
> A由于事务1.1与事务1.2处于同一个bean，且只有通过springAOP代理的对象才会事务生效。（**同类内方法调用即使有@Transactional注解，AOP不会生效**）
>
> 可以**通过SpringContextHolder.getBean（\*.class）获取bean来调用，使事务或AOP生效**

根据配置使用客户额度协议中的利率或从风险驾驶舱中获取利率

若风险驾驶舱中利率和额度协议中的利率不同，更新协议分项利率

> 提交事务1.2

3. 插入唯一交易流水表（事务1.1）

防止重复交易（try）



4. 占用额度（事务1.1）

在占用额度之前，先当前读查询额度变更流水（select for update），防止额度重复占用

select for update 该用户的额度数据（只要事务没有提交，相当于锁住了该客户的读信息）

利用mysql 更新额度数据：剩余额度=原剩余额度-借据金额

插入若干流水

返回更新后的额度分项

5. 贷款预生成（事务1.1）

> 目前已知信息
>
> 产品信息、卡信息、额度协议信息（已占用）、利率、已登记流水（放款请求，额度占用流水）、还款日、客户信息

通过以上信息预生成一笔借据

生成提前申请流水

> 事务1.1结束







## 还款

