---
title:  从区块链角度研究分布式一致性问题
description: 区块链一直是21世纪较为流行的技术，但其本质就是在分布式场景中如何达成共识。这与分布式事务，分布式系统设计异曲同工。
image: 1.png
date: 2025-11-18
categories: 
  - 精选
  - web3
tags:
  - 架构
  - 分布式
  - web3
---

# 区块链



## 拜占庭将军问题

> 世界上只有一种共识协议，就是Paxos，其他的所有共识算法都是Paxos的退化版本。
>
> 虽然Paxos长久以来一直无敌于分布式共识，但paxos在提出时并不能解决拜占庭将军问题。今天就从区块链的角度了解区块链是如何看待分布式共识，并解决拜占庭问题。

**没有拜占庭的世界：**信息可能丢失也可能延迟，但不会被错误传递。

**拜占庭将军问题**：信息可能丢失也可能延迟，<font color='red'>同时有人会故意破坏系统，故意传递错误的信息。</font>

1. 即使有恶意参与者也能正常工作
2. 任何人都可以无需批准的加入
3. 去中心化：完全分布式，无中心网络



> <font color='red'>比特币提出的方案：</font>不是试图确定谁值得信任，而是让撒谎在经济上比说真话更昂贵。工作量证明通过要求参与者消耗真实的计算能量来提出更改。攻击者需要在电力上话费的成本远超过他们通过攻击所能获得的收益。



## 区块链基础

> 对于拜占庭问题，如果有f个叛徒，就至少需要有3f+1个参与者才能保证结果真实性。



4个将军中有一个叛徒。叛徒告诉两个好人进攻，告诉另一个好人撤退。如果只有两个好人进攻。



此时：



| 好人1                                          | 好人2                   | 好人3                   | 结果                                        |
| ---------------------------------------------- | ----------------------- | ----------------------- | ------------------------------------------- |
| 提出：进攻<br />收到：3进攻                    | 收到好人1进攻，坏人撤退 | 收到好人1进攻，坏人撤退 | 好人1误以为全部进攻，但2和3犹豫不觉重新投票 |
| 确认阶段：好人1 又收到了其他两个好人的犹豫答复 |                         |                         | 无限重试                                    |

但paxos会导致决定无法确定（有意的创造了活锁），从而无法达成共识。



传统网络如何解决？

必须事前知道所有的参与者是谁，且不能丢失。

每个参与者给其他所有参与者发送相同的消息，此时在根据得到消息的结果来达成共识。

4个系统就需要，4*3=12次的消息传递，随着系统的增多和意见的不统一，则会更加可能出现问题。

> 网络通讯次数多，随着参与者的增多，达成共识的可能变成几乎不可能。



### 工作量证明（POW）

每个人想要得到自己的结论，必须进行一个昂贵的计算工作

1. 矿工将待记账（确认收货）的交易收集到一个区块中
2. 旷工必须找到一个随机数，和当前区块数据结合并进行hash运算，产生一个特殊（多个零开头）的结果
3. 第一个找到答案的旷工将其方案广播到网络
4. 其他参与者立刻验证解决方案的正确性并开始接收下一个新的区块（上一个区块确认收货，记账成功）下一个新区块的头包含上一次的hash值



- 尝试用pow模拟拜占庭问题

先看上面的场景，假设4个将军，1个叛徒

> 由于工作量是概率问题，4个将军每个人记账成功的概率为25%，则目前好人算力为3，坏人算力为1

pow默认大家都是无限工作的，链是无限延伸的。

叛徒的任务是改变一个已经记账成功的区块。

![1763713085384.png](https://fastly.jsdelivr.net/gh/thecoolboyhan/th_blogs@main/image/2025-11/1763713085384_1763713091538.png)

> 假设每个人单位时间内算计为1，坏人需要在3个好人记录为区块2时完成区块1.1,2.1才能让新加入的参与者以坏人链为开始。

**好人完成区块2需要的算力**：3

**坏人超过区块2需要的算力**：6（3个算力负责完成1.1,3个算力负责完成2.1）+1

坏人如果想要篡改一个区块，则知道需要2*好人数+1的算力

> <font color='red'>篡改并不意味着不可能，只是至少需要掌握2*好人数+1的算力（成本高）</font>

篡改一个的成本如此，如果想要篡改更早的区块，难度几乎不可能，比特币白皮书中关于改账成本的估算：

![1763714740053.png](https://fastly.jsdelivr.net/gh/thecoolboyhan/th_blogs@main/image/2025-11/1763714740053_1763714750245.png)



- 记账成本

如果采用pow模式记账，那对于一个旷工来说记账成功需要成本是多少？



