<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="本次补充批扣和流水同步部分，把账务运行拼图补充完整"><title>个贷核心系统业务与核算规则概览</title><link rel=canonical href=https://thecoolboyhan.github.io/p/%E4%B8%AA%E8%B4%B7%E6%A0%B8%E5%BF%83%E7%B3%BB%E7%BB%9F%E4%B8%9A%E5%8A%A1%E4%B8%8E%E6%A0%B8%E7%AE%97%E8%A7%84%E5%88%99%E6%A6%82%E8%A7%88/><link rel=stylesheet href=/scss/style.min.833d6eed45de56f48306bf57268d5b8cdfc8a60e8e7bdc99810464fcd033f7c6.css><meta property='og:title' content="个贷核心系统业务与核算规则概览"><meta property='og:description' content="本次补充批扣和流水同步部分，把账务运行拼图补充完整"><meta property='og:url' content='https://thecoolboyhan.github.io/p/%E4%B8%AA%E8%B4%B7%E6%A0%B8%E5%BF%83%E7%B3%BB%E7%BB%9F%E4%B8%9A%E5%8A%A1%E4%B8%8E%E6%A0%B8%E7%AE%97%E8%A7%84%E5%88%99%E6%A6%82%E8%A7%88/'><meta property='og:site_name' content='韩永发的博客'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='业务'><meta property='article:tag' content='随笔'><meta property='article:tag' content='账务'><meta property='article:published_time' content='2025-06-04T00:00:00+00:00'><meta property='article:modified_time' content='2025-06-04T00:00:00+00:00'><meta property='og:image' content='https://thecoolboyhan.github.io/p/%E4%B8%AA%E8%B4%B7%E6%A0%B8%E5%BF%83%E7%B3%BB%E7%BB%9F%E4%B8%9A%E5%8A%A1%E4%B8%8E%E6%A0%B8%E7%AE%97%E8%A7%84%E5%88%99%E6%A6%82%E8%A7%88/1.png'><meta name=twitter:title content="个贷核心系统业务与核算规则概览"><meta name=twitter:description content="本次补充批扣和流水同步部分，把账务运行拼图补充完整"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://thecoolboyhan.github.io/p/%E4%B8%AA%E8%B4%B7%E6%A0%B8%E5%BF%83%E7%B3%BB%E7%BB%9F%E4%B8%9A%E5%8A%A1%E4%B8%8E%E6%A0%B8%E7%AE%97%E8%A7%84%E5%88%99%E6%A6%82%E8%A7%88/1.png'><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_63165f4306fe5eb3.png width=300 height=400 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>🍥</span></figure><div class=site-meta><h1 class=site-name><a href=/>韩永发的博客</a></h1><h2 class=site-description>目前人在上海，20年毕业，普通muggle，java开发。邮箱：hanyongfa2013@163.com 。</h2></div></header><ol class=menu-social><li><a href=https://github.com/thecoolboyhan target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://leetcode.cn/u/thecoolboy/ target=_blank title=力扣 rel=me><svg role="img" viewBox="0 0 24 24"><title>LeetCode</title><path d="M13.483.0a1.374 1.374.0 00-.961.438L7.116 6.226l-3.854 4.126a5.266 5.266.0 00-1.209 2.104 5.35 5.35.0 00-.125.513 5.527 5.527.0 00.062 2.362 5.83 5.83.0 00.349 1.017 5.938 5.938.0 001.271 1.818l4.277 4.193.039.038c2.248 2.165 5.852 2.133 8.063-.074l2.396-2.392c.54-.54.54-1.414.003-1.955a1.378 1.378.0 00-1.951-.003l-2.396 2.392a3.021 3.021.0 01-4.205.038l-.02-.019-4.276-4.193c-.652-.64-.972-1.469-.948-2.263a2.68 2.68.0 01.066-.523 2.545 2.545.0 01.619-1.164L9.13 8.114c1.058-1.134 3.204-1.27 4.43-.278l3.501 2.831c.593.48 1.461.387 1.94-.207a1.384 1.384.0 00-.207-1.943l-3.5-2.831c-.8-.647-1.766-1.045-2.774-1.202l2.015-2.158A1.384 1.384.0 0013.483.0zm-2.866 12.815a1.38 1.38.0 00-1.38 1.382 1.38 1.38.0 001.38 1.382H20.79a1.38 1.38.0 001.38-1.382 1.38 1.38.0 00-1.38-1.382z"/></svg></a></li><li><a href=mailto:hanyongfa2013@163.com target=_blank title=邮箱 rel=me><svg id="mdi-email-arrow-right-outline" viewBox="0 0 24 24"><path d="M13 19C13 18.66 13.04 18.33 13.09 18H4V8l8 5 8-5v5.09C20.72 13.21 21.39 13.46 22 13.81V6C22 4.9 21.1 4 20 4H4C2.9 4 2 4.9 2 6V18c0 1.1.9 2 2 2h9.09C13.04 19.67 13 19.34 13 19M20 6l-8 5L4 6H20m0 16V20H16V18h4V16l3 3-3 3z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#业务概览>业务概览</a><ol><li><a href=#主要业务>主要业务</a></li></ol></li><li><a href=#联机业务>联机业务</a><ol><li><a href=#授信>授信</a></li><li><a href=#账户>账户</a></li><li><a href=#放款>放款</a></li><li><a href=#还款>还款</a></li><li><a href=#其他概念>其他概念</a></li></ol></li><li><a href=#批量任务>批量任务</a><ol><li><a href=#批量扣款>批量扣款</a><ol><li><a href=#流程>流程</a></li><li><a href=#业务规则>业务规则</a></li></ol></li><li><a href=#借据代偿>借据代偿</a><ol><li><a href=#业务流程>业务流程</a></li><li><a href=#业务规则-1>业务规则</a></li></ol></li><li><a href=#借据核销>借据核销</a><ol><li><a href=#业务流程-1>业务流程</a></li></ol></li></ol></li><li><a href=#日终任务>日终任务</a><ol><li><a href=#业务流程-2>业务流程</a></li><li><a href=#业务规则-2>业务规则</a></li></ol></li><li><a href=#总结>总结</a></li><li><a href=#贷款>贷款</a><ol><li><a href=#贷款试算>贷款试算</a><ol><li></li></ol></li><li><a href=#放款tcc>放款（TCC）</a><ol><li><a href=#无事务前期准备>无事务前期准备</a></li><li><a href=#信贷管理额度占用预开户事务1try>信贷管理：额度占用+预开户（事务1：try）</a></li><li><a href=#信贷核心放款申请事务2try>信贷核心：放款申请（事务2：try）</a></li><li><a href=#信贷管理放款失败事务1cancel>信贷管理：放款失败（事务1：cancel）</a></li><li><a href=#信贷核心放款取消事务2cancel>信贷核心：放款取消（事务2：cancel）</a></li><li><a href=#信贷管理放款确认事务1confirm>信贷管理：放款确认（事务1：confirm）</a></li><li><a href=#信贷核心放款确认事务2confirm>信贷核心：放款确认（事务2：confirm）</a></li></ol></li></ol></li><li><a href=#还款-1>还款</a><ol><li><a href=#应还款试算>应还款试算</a><ol><li><a href=#前期准备-1>前期准备</a></li><li><a href=#循环每期期供得出利息真正的试算>循环每期期供得出利息（真正的试算）</a></li><li><a href=#利息计算>利息计算</a></li><li><a href=#罚息计算>罚息计算</a></li><li><a href=#费用罚息>费用罚息</a></li><li><a href=#复息计算>复息计算</a></li><li><a href=#复息补计提>复息补计提</a></li><li><a href=#反向计提>反向计提</a></li><li><a href=#处理减免>处理减免</a></li><li><a href=#正常还款试算总结>正常还款试算总结</a></li></ol></li><li><a href=#提前还款试算>提前还款试算</a><ol><li><a href=#前期准备-2>前期准备</a></li><li><a href=#调用放款试算重新生成期供信息>调用放款试算重新生成期供信息</a></li><li><a href=#提前还款本金>提前还款本金</a></li><li><a href=#提前还款利息>提前还款利息</a></li><li><a href=#提前还款费用>提前还款费用</a></li><li><a href=#提前还款利息优惠陕西农信>提前还款利息优惠（陕西农信）</a></li><li><a href=#摊薄金额>摊薄金额</a></li><li><a href=#做优惠>做优惠</a></li><li><a href=#利用剩余本金重新生成还款计划>利用剩余本金重新生成还款计划</a></li><li><a href=#提前还款试算总结>提前还款试算总结</a></li></ol></li><li><a href=#正常还款tcc>正常还款（TCC)</a><ol><li><a href=#信贷管理还款事务1try>信贷管理：还款（事务1：try）</a></li><li><a href=#信贷核心正常还款事务2try>信贷核心：正常还款（事务2：try）</a></li><li><a href=#信贷管理还款取消事务1cansel>信贷管理：还款取消（事务1：cansel）</a></li><li><a href=#信贷核心还款取消事务2cansel>信贷核心：还款取消（事务2：cansel）</a></li><li><a href=#信贷管理还款确认事务1confirm>信贷管理：还款确认（事务1：confirm）</a></li><li><a href=#信贷核心正常还款确认事务2confirm>信贷核心：正常还款确认（事务2：confirm）</a></li><li><a href=#正常还款总结>正常还款总结</a></li></ol></li></ol></li><li><a href=#特别说明>特别说明</a><ol><li><a href=#信贷核心还款锁定说明乐观锁>信贷核心还款锁定说明（乐观锁）</a></li></ol></li><li><a href=#计算器>计算器</a><ol><li><a href=#放款-1>放款</a><ol><li><a href=#等额本金计算器>等额本金计算器</a></li><li><a href=#等额本息计算器>等额本息计算器</a></li></ol></li></ol></li><li><a href=#批量还款>批量还款</a><ol><li><a href=#批量还款准备>批量还款准备</a></li><li><a href=#自营批量还款幂等>自营批量还款(幂等)</a></li></ol></li><li><a href=#流水状态同步>流水状态同步</a><ol><li><a href=#自营流水状态同步>自营流水状态同步</a><ol><li><a href=#虚账户提现或红包提现的流水同步>虚账户提现或红包提现的流水同步</a></li><li><a href=#放款流水同步>放款流水同步</a></li><li><a href=#还款流水同步>还款流水同步</a></li></ol></li><li><a href=#合作方放款流水同步>合作方放款流水同步</a></li><li><a href=#合作方还款流水同步>合作方还款流水同步</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/%E4%B8%AA%E8%B4%B7%E6%A0%B8%E5%BF%83%E7%B3%BB%E7%BB%9F%E4%B8%9A%E5%8A%A1%E4%B8%8E%E6%A0%B8%E7%AE%97%E8%A7%84%E5%88%99%E6%A6%82%E8%A7%88/><img src=/p/%E4%B8%AA%E8%B4%B7%E6%A0%B8%E5%BF%83%E7%B3%BB%E7%BB%9F%E4%B8%9A%E5%8A%A1%E4%B8%8E%E6%A0%B8%E7%AE%97%E8%A7%84%E5%88%99%E6%A6%82%E8%A7%88/1_hu_3f0cd1343e5e5bfe.png srcset="/p/%E4%B8%AA%E8%B4%B7%E6%A0%B8%E5%BF%83%E7%B3%BB%E7%BB%9F%E4%B8%9A%E5%8A%A1%E4%B8%8E%E6%A0%B8%E7%AE%97%E8%A7%84%E5%88%99%E6%A6%82%E8%A7%88/1_hu_3f0cd1343e5e5bfe.png 800w, /p/%E4%B8%AA%E8%B4%B7%E6%A0%B8%E5%BF%83%E7%B3%BB%E7%BB%9F%E4%B8%9A%E5%8A%A1%E4%B8%8E%E6%A0%B8%E7%AE%97%E8%A7%84%E5%88%99%E6%A6%82%E8%A7%88/1_hu_458ed839f8722c4f.png 1600w" width=800 height=533 loading=lazy alt="Featured image of post 个贷核心系统业务与核算规则概览"></a></div><div class=article-details><header class=article-category><a href=/categories/%E9%87%91%E8%9E%8D/>金融
</a><a href=/categories/%E7%B2%BE%E9%80%89/>精选
</a><a href=/categories/%E4%B8%AA%E8%B4%B7%E6%A0%B8%E5%BF%83/>个贷核心</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/%E4%B8%AA%E8%B4%B7%E6%A0%B8%E5%BF%83%E7%B3%BB%E7%BB%9F%E4%B8%9A%E5%8A%A1%E4%B8%8E%E6%A0%B8%E7%AE%97%E8%A7%84%E5%88%99%E6%A6%82%E8%A7%88/>个贷核心系统业务与核算规则概览</a></h2><h3 class=article-subtitle>本次补充批扣和流水同步部分，把账务运行拼图补充完整</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2025-06-04T00:00:00Z>Jun 04, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 25 分钟</time></div></footer></div></header><section class=article-content><p>[TOC]</p><h2 id=业务概览>业务概览</h2><ul><li>授信</li><li>放款</li><li>还款</li></ul><h3 id=主要业务>主要业务</h3><blockquote><p>授信、绑卡、放款、还款、债务重组、不规则还款、延展期、诉讼回款、柜面还款、LPR利率浮动、核销、代偿、机构撤并、管护移交、批量扣款、代偿后还款、日终账务、短信通知、记账机构管理、额度管理、客户信息管理、借据管理、贷款凭证管理、合同管理、核心产品管理、LPR利率维护、银行核心模式、助贷模式、税价分离&mldr;</p></blockquote><h2 id=联机业务>联机业务</h2><blockquote><p>授信维护、绑卡维护、客户基础信息维护、合同维护、管护机构及记账机构维护、放款、还款、借据信息维护等</p></blockquote><h3 id=授信>授信</h3><p>授信是业务开始，只有授信后才能开始贷款。</p><ul><li>额度：客户在一定时间内能够申请贷款的最高金额</li><li>业务：变更、冻结、解冻、额度占用、恢复、失效、注销</li><li>额度类型：循环额度、一次性额度、一次性多次使用额度</li></ul><h3 id=账户>账户</h3><ul><li><p>账户：他行卡与本行卡的鉴权、绑定、解绑，用于客户收款和还款</p></li><li><p>鉴权：为了确保用户的真实性和支付的安全性，一般是四要素鉴权</p></li></ul><h3 id=放款>放款</h3><ul><li>预防款：完成产品，额度等校验，生成借据号等关键信息。</li><li>放款确认：再次校验产品、额度等信息，完成额度占用，生成借据、期供等基本信息</li><li>支付放款：调用支付，完成放款（标准放款、受托支付）</li><li>核算记账：放款成功后，异步通知会计核算记账</li></ul><h3 id=还款>还款</h3><ul><li>正常还款：借据到期后的还款</li><li>提前还款：提前N天还当期</li><li>提前还N期：缩期，每期本金不变，总期数减少</li><li>提前还部分：摊薄，每期本金减少，总期数不变</li></ul><h3 id=其他概念>其他概念</h3><ul><li>期供：每个借据都有对应的期供，期供记录了每一期还款的本金、利息、开始日、到期日期等。</li><li>还款方式：等额本金、等额本息、先息后本、一次性还本付息，周期性还本付息，气球贷，不规则还款。</li><li>利率：正常利率，罚息利率，复息利率</li><li>优惠券：N天免息券、利率折扣券、N期免息券、固定利率券、利息抵扣券</li><li>还款日：固定还款日、范围随机还款日、最大还款日、还款日间隔</li></ul><h2 id=批量任务>批量任务</h2><blockquote><p>各种流水状态同步、批量、代偿、银行核心模式行内数据拉取等</p></blockquote><h3 id=批量扣款>批量扣款</h3><blockquote><p>客户借据到期后，每日执行的扣款任务</p></blockquote><h4 id=流程>流程</h4><ol><li>任务生成：按商户、数据库节点、时间点、支付通道等生成批扣</li><li>数据载入：按生成的不同批扣任务，载入对应的需要批扣的数据</li><li>执行扣款：按人加产品维度，结合还款账户生成扣款记录，发起扣款</li><li>短信发送：客户所有借据扣款完成后，按人维度发送扣款结果短信</li></ol><h4 id=业务规则>业务规则</h4><ul><li><p>扣款时间</p><p>批扣时间点支持配置，配置三次时间 8、16、20点批扣</p></li><li><p>并发控制</p><p>涉及部分特殊支付渠道的扣款，批扣可以设置不同的并发数量控制</p></li><li><p>扣款账户</p><p>扣款账户的顺序是按照产品维度配置的，主流扣款顺序：自有虚账户&ndash;>行内虚账户&ndash;> 本行卡&ndash;> 他行卡</p></li><li><p>余额查询</p><p>扣款前会查询余额，如果余额不足，按可用余额扣款</p></li><li><p>批扣短信</p><p>扣款完成后，准实时发送扣款短信</p></li></ul><h3 id=借据代偿>借据代偿</h3><blockquote><p>借据人无法按时偿还贷款时，由担保人或保险公司等第三方代为偿还的业务</p></blockquote><h4 id=业务流程>业务流程</h4><ol><li>代偿试算：命中代偿规则的借据，进行代偿试算，生成代偿明细</li><li>申请文件：根据代偿明细，生成批量代偿申请文件，上传OSS</li><li>文件通知：申请文件上传完成后，通过支付通知行内代偿申请已提交</li><li>审批结果：批量代偿审批文件下载、解析、更新审批状态：通过或拒绝，审批通过的借据，会发起代偿还款</li><li>代偿结果：代偿完成后，生成代偿结果文件，上传</li></ol><h4 id=业务规则-1>业务规则</h4><ul><li><p>代偿天数</p><p>只借据的逾期天数，分为单期代偿天数、整笔代偿天数</p></li><li><p>代偿方式</p><p>单期代偿：单期天数控制，单期做代偿</p><p>整笔代偿：由整笔借据逾期天数控制，做整笔借据代偿</p></li><li><p>账户管理</p><p>按渠道配置代偿账户，或在借据放款时指定代偿账户</p></li><li><p>文件同步</p><p>还款预估文件、代偿申请文件、代偿审批文件、代偿结果文件的同步</p></li></ul><h3 id=借据核销>借据核销</h3><blockquote><p>核销后贷款从资产负债表中剔除，相关坏账不计入当期损益</p></blockquote><h4 id=业务流程-1>业务流程</h4><ol><li>商户校验：商户是否支持核销，减值核销或非减值核销，核销时是否检查计提</li><li>产品校验：产品是否支持核销，核销贷款余额，核销逾期天数是否满足要求</li><li>借据校验：借据状态是否正常，是否处理中，是否做过资产剥离，是否已经核销，贷款余额，逾期天数是否满足条件，最大逾期天数内是否有成功还款记录</li></ol><h2 id=日终任务>日终任务</h2><blockquote><p>计提、结息、转列、拨备、计税</p></blockquote><h3 id=业务流程-2>业务流程</h3><ol><li>日切前：根据日切时间点，拦截前后10分钟的所有交易</li><li>日切中-交易拦截：拦截掉除放款外，其他影响账务的交易</li><li>日切中-核心：执行计提、结息、转列、拨备，生成对应文件通知会计核系统处理</li><li>日切中-会计核算：处理核心系统计提、结息、转列、拨备等文件</li><li>日切中-ODS：待核心系统及会计核算系统数据处理完成后，通知ODS抽数</li><li>日间：ODS完成供数后，通知核心切日间，继续处理被阻塞的还款交易，当日零金额还款的业务。</li></ol><h3 id=业务规则-2>业务规则</h3><ul><li><p>计提</p><p>对当天应收客户的贷款利息进行计算，体现银行的贷款利息收入</p></li><li><p>结息</p><p>按约定的时间从客户账扣收贷款利息，体现银行和借据人之间的利息结算</p></li><li><p>转列</p><p>处理贷款借据的四级分类：正常、逾期、呆滞、呆账</p></li><li><p>拨备</p><p>贷款减值准备，拨备金额主要根据贷款的五级分类来确定</p></li></ul><h2 id=总结>总结</h2><p><img src=/p/%E4%B8%AA%E8%B4%B7%E6%A0%B8%E5%BF%83%E7%B3%BB%E7%BB%9F%E4%B8%9A%E5%8A%A1%E4%B8%8E%E6%A0%B8%E7%AE%97%E8%A7%84%E5%88%99%E6%A6%82%E8%A7%88/%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B.jpg width=1099 height=458 srcset="/p/%E4%B8%AA%E8%B4%B7%E6%A0%B8%E5%BF%83%E7%B3%BB%E7%BB%9F%E4%B8%9A%E5%8A%A1%E4%B8%8E%E6%A0%B8%E7%AE%97%E8%A7%84%E5%88%99%E6%A6%82%E8%A7%88/%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B_hu_8fc76aba7fb02981.jpg 480w, /p/%E4%B8%AA%E8%B4%B7%E6%A0%B8%E5%BF%83%E7%B3%BB%E7%BB%9F%E4%B8%9A%E5%8A%A1%E4%B8%8E%E6%A0%B8%E7%AE%97%E8%A7%84%E5%88%99%E6%A6%82%E8%A7%88/%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B_hu_af3aa2e41c0525b6.jpg 1024w" loading=lazy alt=业务流程 class=gallery-image data-flex-grow=239 data-flex-basis=575px></p><p><img src=/p/%E4%B8%AA%E8%B4%B7%E6%A0%B8%E5%BF%83%E7%B3%BB%E7%BB%9F%E4%B8%9A%E5%8A%A1%E4%B8%8E%E6%A0%B8%E7%AE%97%E8%A7%84%E5%88%99%E6%A6%82%E8%A7%88/%E5%80%9F%E6%8D%AE%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.jpg width=1259 height=286 srcset="/p/%E4%B8%AA%E8%B4%B7%E6%A0%B8%E5%BF%83%E7%B3%BB%E7%BB%9F%E4%B8%9A%E5%8A%A1%E4%B8%8E%E6%A0%B8%E7%AE%97%E8%A7%84%E5%88%99%E6%A6%82%E8%A7%88/%E5%80%9F%E6%8D%AE%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F_hu_1cfb8ec76e7cdada.jpg 480w, /p/%E4%B8%AA%E8%B4%B7%E6%A0%B8%E5%BF%83%E7%B3%BB%E7%BB%9F%E4%B8%9A%E5%8A%A1%E4%B8%8E%E6%A0%B8%E7%AE%97%E8%A7%84%E5%88%99%E6%A6%82%E8%A7%88/%E5%80%9F%E6%8D%AE%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F_hu_d9ccfbace15b9226.jpg 1024w" loading=lazy alt=借据的生命周期 class=gallery-image data-flex-grow=440 data-flex-basis=1056px></p><h2 id=贷款>贷款</h2><p>由于各个银行情况不同，有些并不使用本核心做放款、还款等操作。银行为核心的产品本系统只需路由到对应的银行请求行内接口，获取结果。</p><ul><li>具体的路由方式</li></ul><p>目前有两种路由方式：</p><ol><li>通过产品号来路由（优先）：通过银行（租户）+产品的维度请求对应的接口</li><li>通过银行路由：有些银行只有一个统一的请求接口，无需区分产品。</li></ol><blockquote><p>银行相关的配置信息，统一放入路由配置表，通过请求中的产品号获取对应的规则。</p></blockquote><blockquote><p>接下来的所有流程为自有核心流程</p></blockquote><h3 id=贷款试算>贷款试算</h3><blockquote><p>放款提现请的准备重要规则，预生成还款计划、计划利息、借据信息等。</p></blockquote><h5 id=前期准备>前期准备</h5><ul><li>首次还款日</li></ul><p>后续期供信息需要根据首次还款日，来向后累计。在交给计算器来生成期供之前，需要先准备好首次还款日。</p><blockquote><p>所有产品的首次还款日默认不许超过28（不许出现29、30、31等）</p></blockquote><div class=table-wrapper><table><thead><tr><th>类型</th><th>结果</th></tr></thead><tbody><tr><td>固定还款日</td><td>每月都使用固定还款日期来还款</td></tr><tr><td>固定还款日（下月）</td><td>小于等于固定还款日：使用下月固定还款日<br>大于固定还款日：使用下下月固定还款日</td></tr><tr><td>随机【1,10】</td><td>1到10号随机一天</td></tr><tr><td>随机【11,20】</td><td>11到20号随机一天</td></tr><tr><td>随机【21,28】</td><td>21到28号随机一天</td></tr></tbody></table></div><blockquote><p>如果客户信息中，曾记录过用户的还款日，尽量使用相同的还款日。（方便合并批扣）</p></blockquote><ul><li>获取利率（授信协议）</li></ul><p>从授信协议分项中查出授信时风险模型提供的客户贷款利率。</p><h5 id=试算>试算</h5><blockquote><p>通过首次还款日、利率信息。来预生成还款计划和借据信息</p></blockquote><p>信贷核心执行过程均采用责任链模式，每一步时都会判断是否继续向后执行，无论中间哪一环出现问题直接让流程失败。</p><ul><li><p>试算物料初始化</p><p>贷款开始日期、产品信息、优惠券信息</p></li><li><p>使用原始利率试算（折前利率）</p></li></ul><p>根据还款方式来选择试算器</p><blockquote><p>不同还款方式的试算器</p></blockquote><div class=table-wrapper><table><thead><tr><th>还款方式</th><th>试算器</th></tr></thead><tbody><tr><td>先息后本</td><td>等额本金计算器</td></tr><tr><td>等额本息</td><td>等额本息计算器</td></tr><tr><td>等额本金</td><td>等额本金计算器</td></tr><tr><td>自定义周期性还本还息</td><td>等额本金计算器</td></tr><tr><td>气球贷等额本息</td><td>气球贷等额本息计算器</td></tr><tr><td>气球贷等额本金</td><td>气球贷等额本金计算器</td></tr><tr><td>气球贷自定义周期性还本还息</td><td>气球贷等额本金计算器</td></tr></tbody></table></div><blockquote><p>各计算器计算方式后文详解</p></blockquote><p>通过试算器试算出：</p><p>本息总金额、利息、下次还款日、到期日、还款明细、还款期数</p><p>通过试算器得出的为折前利率，但未使用优惠，需要对总金额和利息使用优惠券（优惠券为负值）</p><p><strong>当期初始利息=剩余本金*年利率*计息天数（距离放款的天数）/年计息规则天数（360或365）</strong></p><blockquote><p>目前已知的情报：</p><p>1、贷款开始日期、产品信息、优惠券信息</p><p>2、折前：本息总金额、利息、下次还款日、到期日、还款明细、还款期数</p></blockquote><ul><li>折后利率计算</li></ul><blockquote><p>返回折后利率</p></blockquote><p>优惠后金额需要通过折扣利率来计算，优惠有两种</p><ol><li>利率折扣：<strong>折后利率=正常利率*折扣率</strong></li><li>利息优惠券：<strong>折后利率=（（折前总利息-|优惠券固定优惠利息金额|）/折前总利息</strong></li></ol><blockquote><p>目前已知的情报：</p><p>1、贷款开始日期、产品信息、优惠券信息</p><p>2、折前：本息总金额、利息、下次还款日、到期日、还款明细、还款期数</p><p>3、折后利率</p></blockquote><ul><li>通过折后利率在进行一次试算</li></ul><p>上一步中得出折后利率，利用折后利率在进行一次试算，就可得出优惠后的利息情况。</p><blockquote><p>目前已知的情报：</p><p>1、贷款开始日期、产品信息、优惠券信息</p><p>2、折前：本息总金额、利息、下次还款日、到期日、还款明细、还款期数</p><p>3、折后利率</p><p>4、折后：本息总金额、利息、下次还款日、到期日、还款明细、还款期数</p></blockquote><ul><li>试算出每期优惠的金额</li></ul><p>通过优惠试算器试算出每期优惠的金额</p><div class=table-wrapper><table><thead><tr><th>优惠方式</th><th>试算器</th></tr></thead><tbody><tr><td>放款使用（折后利息计算还款计划+折扣不提（初始就是折后利息）+回收补提）</td><td>放款优惠试算器</td></tr><tr><td>放款使用（折后利息计算还款计划+折扣不提（初始就是折后利息）+回收补提 等额本息使用优惠券）</td><td>放款优惠试算器</td></tr><tr><td>还款使用（折前利息计算还款计划+折扣反提+回收补提）（默认试算器）</td><td>还款优惠试算器</td></tr><tr><td>还款使用（折前利息计算还款计划+折扣反提+回收补提 等额本息）</td><td>还款优惠试算器</td></tr></tbody></table></div><ul><li>费用计算</li></ul><p>按出资比率或约定费用计算出所需费用</p><h5 id=放款试算总结>放款试算总结</h5><p>通过以下信息试算出期供明细+借据</p><ol><li>试算物料初始化：贷款开始日期、产品信息、优惠券信息</li><li>使用原始利率试算（折前利率）：本息总金额（折前）、利息（折前）、下次还款日、到期日、还款明细、还款期数</li><li>折后利率计算：折后利率</li><li>用折后利率试算：本息总金额（折后）、利息（折后）、下次还款日、到期日、还款明细、还款期数</li><li>抵扣金额：每期优惠金额</li><li>费用计算：根据规则计算出费用</li></ol><ul><li>放款试算必须的条件：</li></ul><p>产品信息、放款金额、从授信中获取的利率、期数、还款周期、放款日期、优惠方式。</p><h3 id=放款tcc>放款（TCC）</h3><h4 id=无事务前期准备>无事务前期准备</h4><ul><li>生成唯一流水</li></ul><p>为了防止重复放款，先生成一条唯一交易流水，插入唯一交易流水表（放款、还款同表）。通过唯一约束的交易流水，防重放。</p><ul><li>查询产品信息</li></ul><p>通过请求参数，查询本次贷款产品信息。</p><h4 id=信贷管理额度占用预开户事务1try>信贷管理：额度占用+预开户（事务1：try）</h4><p>开启事务Transactional</p><ul><li>获取客户额度与额度协议分项(事务1.1)</li></ul><p>校验还款方式、末期本金比例是否合规等</p><blockquote><p>目前已有：额度信息（未被占用）、协议信息</p></blockquote><ul><li>计算还款日(事务1.1)</li></ul><p>根据入参计算还款日，校验卡信息</p><blockquote><p>目前已有：</p><p>1、额度信息（未被占用）、协议信息</p><p>2、还款日</p></blockquote><ul><li>查询（客户+产品）名下所有的申请信息（成功+处理中的）(事务1.1)</li></ul><p>在本次放款记录落库前，先查询一遍申请信息</p><ul><li>真正的放款try(事务1.1)</li></ul><blockquote><p>利率抉择、额度占用、登记流水</p></blockquote><ol><li>校验客户信息(事务1.1)</li></ol><p>判断客户是否可以再借款等</p><ol start=2><li>抉择利率（开启一个新事务1.2）</li></ol><blockquote><p>Q如何在一个事务中同一个bean内的方法调用，开启一个新事务？</p><p>A由于事务1.1与事务1.2处于同一个bean，且只有通过springAOP代理的对象才会事务生效。（<strong>同类内方法调用即使有@Transactional注解，AOP不会生效</strong>）</p><p>可以<strong>通过SpringContextHolder.getBean（*.class）获取bean来调用，使事务或AOP生效</strong></p></blockquote><p>根据配置使用客户额度协议中的利率或从风险驾驶舱中获取利率</p><p>若风险驾驶舱中利率和额度协议中的利率不同，更新协议分项利率</p><blockquote><p>提交事务1.2</p></blockquote><ol start=3><li>插入唯一交易流水表（事务1.1）</li></ol><p>防止重复交易（try）</p><ol start=4><li>占用额度（事务1.1）</li></ol><p>在占用额度之前，先当前读查询额度变更流水（select for update），防止额度重复占用</p><p>select for update 该用户的额度数据（只要事务没有提交，相当于锁住了该客户的读信息）</p><p>利用mysql 更新额度数据：剩余额度=原剩余额度-借据金额</p><p>插入若干流水</p><p>返回更新后的额度分项</p><ol start=5><li>贷款预生成（事务1.1）</li></ol><blockquote><p>目前已知信息</p><p>产品信息、卡信息、额度协议信息（已占用）、利率、已登记流水（放款请求，额度占用流水）、还款日、客户信息</p></blockquote><p>通过以上信息预生成一笔借据</p><p>生成提前申请流水</p><blockquote><p>事务1.1结束</p></blockquote><h4 id=信贷核心放款申请事务2try>信贷核心：放款申请（事务2：try）</h4><ul><li>使用独立事务登记各种流水（事务2.1）</li></ul><p>登记交易流水、贷款系统流水、支付用流水、扩展流水。</p><blockquote><p>使用同一事务完成各系统流水登记，保证请求都被记录</p></blockquote><blockquote><p>事务2.1结束</p></blockquote><ul><li>​ 放款前检查（事务2.2）</li></ul><p>是否营业校验、头寸校验、代偿校验</p><ul><li>生成借据号（事务2.2）</li></ul><p>生成借据号、获取优惠起始期数</p><ul><li>贷款试算（事务2.2）</li></ul><p>调用贷款试算，生成期供、借据等</p><ul><li>开户（事务2.2）</li></ul><blockquote><p>事务2.2结束</p></blockquote><ul><li>调用支付系统开始放款</li></ul><p>接收支付返回值，根据返回结果决定：处理中（挂起）、成功、失败。</p><h4 id=信贷管理放款失败事务1cancel>信贷管理：放款失败（事务1：cancel）</h4><blockquote><p>开启事务1.1</p></blockquote><ul><li><strong>分布式事务防止资源悬挂</strong></li></ul><p><strong>try请求由于网络阻塞在cancel请求后才执行</strong></p><p><strong>解决方式：在cancel之前，先尝试插入一遍try的流水</strong></p><ul><li>恢复额度（1.1）</li></ul><p>将之前占用的额度取消</p><ul><li>取消台账流水（1.1）</li></ul><p>将之前预生成的流水状态置为取消</p><blockquote><p>事务1.1结束</p></blockquote><h4 id=信贷核心放款取消事务2cancel>信贷核心：放款取消（事务2：cancel）</h4><blockquote><p>开启事务2.1</p></blockquote><ul><li>更新流水（事务2.1）</li></ul><p>将之前的账务流水、交易流水、主流水、支付流水置为失败</p><blockquote><p>事务2.1结束</p></blockquote><h4 id=信贷管理放款确认事务1confirm>信贷管理：放款确认（事务1：confirm）</h4><blockquote><p>事务1.1</p></blockquote><ul><li><p>放款申请、台账历史流水确认（事务1.1）</p></li><li><p>更新授信协议分项中的放款金额（事务1.1）</p></li></ul><blockquote><p>事务1.1 结束</p></blockquote><h4 id=信贷核心放款确认事务2confirm>信贷核心：放款确认（事务2：confirm）</h4><p>事务2.1</p><ul><li><p>更新账户信息、借据状态等为成功（2.1）</p></li><li><p>将新借据信息发送给ACT服务（信贷核算）记账（2.1）</p></li><li><p>更新计税（若有）事务2.1</p></li></ul><p>事务2.1结束</p><h2 id=还款-1>还款</h2><h3 id=应还款试算>应还款试算</h3><h4 id=前期准备-1>前期准备</h4><p>查出借据所有期供、查询宽限期、恢复正常利率（之前利率有可能应折扣导致不准）、处理柜面还款部分</p><h4 id=循环每期期供得出利息真正的试算>循环每期期供得出利息（真正的试算）</h4><p>每期借据大致分为几种情况</p><ul><li>为满足正常的还款日要求</li></ul><p>未到期的期供、交易日未到达正常还款日、不展示的期供信息</p><blockquote><p>统一跳过处理</p></blockquote><ul><li>未介入待还时间线的期供</li></ul><blockquote><p>跳过</p></blockquote><ul><li>其他情况的期供会进入试算</li></ul><blockquote><p>已知的情报：</p><p>期供信息（未试算）、宽限期</p></blockquote><h4 id=利息计算>利息计算</h4><ul><li>需要的数据</li></ul><p>起息日sD，上次计提日（可能为空）pD、当前交易日tD</p><p>初始利息（放款时试算得出）、已计提利息（每期的已计提利息）</p><ul><li>pD>=结束日期</li></ul><p>本期不再计息 return 0；</p><ul><li>pD为空</li></ul><p>没有计提过，让pD等于sD</p><p>计息天数：当前日期-起息日</p><p>剩余本金：当期金额+当期后的总剩余本金</p><div class=table-wrapper><table><thead><tr><th>计息方式</th><th>计算原理</th></tr></thead><tbody><tr><td>按日累计</td><td>（当期本金+当期之后的剩余本金）*年利率*计息天数/年计息天数（360或365） 结果保留8位小数4舍5入</td></tr><tr><td>按日计息</td><td>剩余本金*年利率/年计息天数*计息天数 保留两位小数</td></tr></tbody></table></div><p>放上得出应计息金额后 - 已计提金额 =本次计提金额</p><ul><li>计息后记账</li></ul><p>根据减值表示记录表内或表外、应收应计利息和利息发生额</p><blockquote><p>转表外当天利息记表内</p></blockquote><h4 id=罚息计算>罚息计算</h4><p>罚息计算流程与计算逻辑大致与利息计算相同</p><ul><li>不同点</li></ul><p>罚息存在罚息利率</p><p>宽限期内：使用正常利率参与罚息计算（宽限期内可能存不记罚息的情况，后续用罚息利率一把补记）</p><p>宽限期外：使用罚息利率参与计算</p><h4 id=费用罚息>费用罚息</h4><p>费用计算与罚息、利息计算逻辑相似，根据配置决定费用利率</p><blockquote><p>本金*罚息利率</p></blockquote><h4 id=复息计算>复息计算</h4><p>同上</p><blockquote><p>(应收欠息+催收/减值欠息) *复息利率</p></blockquote><h4 id=复息补计提>复息补计提</h4><ul><li>复息为什么存在补计提场景？</li></ul><p>因为有优惠的情况存在，优惠有两种，一种还款时优惠，一种放款即优惠。如果放款优惠，期供中目前记录的利息为减免后利息， 但还复息的场景中，可能存在优惠券失效情况。若优惠券失效，需补计提减免部分的复息。</p><blockquote><p>减免金额（取反）*复息利率</p></blockquote><h4 id=反向计提>反向计提</h4><p>因部分银行要求利息、罚息、复息等不能超过一定比例，如超过比例需反向计提。</p><blockquote><p>反向计提金额：目前已计提金额-最大比例计算得出金额</p></blockquote><h4 id=处理减免>处理减免</h4><p>根据上方得出的各种值做还款减免计算</p><blockquote><p>直接从上方金额做扣减</p></blockquote><p>还款试算结束</p><h4 id=正常还款试算总结>正常还款试算总结</h4><ol><li>查出：期供、柜面还款金额、利率、宽限期</li><li>按期完成试算</li><li>利息：利用剩余本金、利率完成试算</li><li>罚息：需考虑宽限期（宽限期计息、不计息等），利用剩余本金、罚息利率完成</li><li>罚息费用（如有）：根据产品配置情况，利用剩余本金、罚息费用利率完成</li><li>复息：利用利息金额、复息利率完成</li><li>复息补计提（如有）：利用已减免利息、复息利率完成</li><li>反向计提：检测是否超标，若超则扣减</li><li>减免：还款时对各种优惠减免</li></ol><blockquote><p>正常还款试算流程简单，计算规则统一</p></blockquote><div class=table-wrapper><table><thead><tr><th>计息方式</th><th>计算原理</th></tr></thead><tbody><tr><td>按日累计（跳切时）</td><td>（当期本金+当期之后的剩余本金）*年利率*计息天数/年计息天数（360或365） 结果保留8位小数4舍5入</td></tr><tr><td>按日计息（正常情况）</td><td>剩余本金*年利率/年计息天数*计息天数 保留两位小数</td></tr></tbody></table></div><h3 id=提前还款试算>提前还款试算</h3><h4 id=前期准备-2>前期准备</h4><p>准备出：交易日期、提前还款方式、提前还款金额、提前还款期数、利率、优惠信息等</p><p>同时对本次还款进行校验</p><h4 id=调用放款试算重新生成期供信息>调用放款试算重新生成期供信息</h4><ul><li>重新生成期供</li></ul><p>由于需要涉及未来期次还款，之前使用优惠生成的期供新歘不可用，需调用放款试算来重新生成期供，对本次还款做扣减，方便后续扣款使用</p><ul><li>求出剩余本金</li></ul><p>借据剩余金额-当前试算期供的累计本金（当次应还款金额）</p><p>还款后剩余本金</p><p>根据还款方式做不同的处理</p><h4 id=提前还款本金>提前还款本金</h4><div class=table-wrapper><table><thead><tr><th>还款方式</th><th>处理方式</th></tr></thead><tbody><tr><td>提前结清</td><td>还款金额为剩余金额</td></tr><tr><td><strong>提前部分还款</strong></td><td>校验金额后暂不处理（仍为输入时金额）</td></tr><tr><td><strong>提前还本（退货）</strong></td><td>只校验（仍为输入时金额）</td></tr><tr><td>提前还当期</td><td>还款本金为当期期次的剩余本金</td></tr><tr><td>提前还N期</td><td>还款本金为输入n期的剩余本金汇总</td></tr><tr><td>提前柜面还款</td><td>试算金额- 柜面金额</td></tr></tbody></table></div><h4 id=提前还款利息>提前还款利息</h4><div class=table-wrapper><table><thead><tr><th>提前还款方式</th><th>利息金额</th></tr></thead><tbody><tr><td>提前结清</td><td>当前已计提的利息汇总</td></tr><tr><td>提前还当期</td><td>当前已计提的利息汇总</td></tr><tr><td>提前还N期</td><td>当前已计提的利息汇总</td></tr><tr><td>提前柜面还款</td><td>0</td></tr><tr><td><strong>提前还本（退货）</strong></td><td>0</td></tr><tr><td>提前部分还款</td><td>特殊处理</td></tr></tbody></table></div><ul><li>对于提前部分还款的特殊处理</li></ul><p>提前还款利息=天数*提前还款本金*年利率/年计息天数</p><p>应收应计利息和：汇总每期已计提利息金额</p><p>取两个利息的较小值：Math.min(提前还款利息,应收应计利息)</p><h4 id=提前还款费用>提前还款费用</h4><p>提前还款费用=天数*借据金额*费用年利率/年计息天数</p><h4 id=提前还款利息优惠陕西农信>提前还款利息优惠（陕西农信）</h4><p>提前还款利息优惠=天数*剩余本金*优惠利率/年计息天数（取反）</p><h4 id=摊薄金额>摊薄金额</h4><div class=table-wrapper><table><thead><tr><th>摊薄方式</th><th>逻辑</th></tr></thead><tbody><tr><td>诉讼还款</td><td>按照传输的还款顺序还款</td></tr><tr><td>期供优先</td><td>根据配置还款顺序还款：大致为<br>应计：罚、利、本<br>非应计：本、利、罚<br>注意：核心账务并不怎么额外关心核销标识</td></tr><tr><td>纵向优先</td><td>先还本、总利息、总费用、总费用罚息</td></tr><tr><td>本金优先</td><td>按期扣减本金、后按期还利息</td></tr></tbody></table></div><p>根据上方还款方式后摊薄期供。</p><h4 id=做优惠>做优惠</h4><p>若有n期免息、n天免息券、利息减免券等再在现有期供上做扣减</p><h4 id=利用剩余本金重新生成还款计划>利用剩余本金重新生成还款计划</h4><p>利用还款后的剩余本金重新生成还款计划，如借据并未结清，则该此还款后，后续该借据以本次新生成的还款计划为准。</p><blockquote><p>提前还款试算结束</p></blockquote><h4 id=提前还款试算总结>提前还款试算总结</h4><ol><li>先准备交易日期、提前还款方式、提前还款金额、提前还款期数、利率、优惠信息等</li><li>由于优惠可能失效，需重新生成还款计划</li><li>根据还款方式，试算出本次还款需要还的金额（本、利、费用）</li><li>根据实还金额对现有期供做扣减（顺序有三种：期供优先、本金优先、纵向优先）</li><li>若有剩余本金则利用剩余本金重新生成期供、给客户后续使用</li></ol><h3 id=正常还款tcc>正常还款（TCC)</h3><p>还款前校验：日切中不能还款，批量还款预先记录一条批量还款请求流水（try）</p><h4 id=信贷管理还款事务1try>信贷管理：还款（事务1：try）</h4><blockquote><p>正常还款、提前还款信贷管理逻辑统一</p></blockquote><blockquote><p>开启事务1.1</p></blockquote><ul><li><p>查询客户额度（事务：1.1）</p></li><li><p>校验客户信息（事务：1.1）</p></li><li><p>增加还款申请流水和台账流水（事务：1.1）</p></li></ul><blockquote><p>若为批量还款，则直接使用中台记录的批量还款请求流水</p></blockquote><blockquote><p>事务1.1结束</p></blockquote><h4 id=信贷核心正常还款事务2try>信贷核心：正常还款（事务2：try）</h4><blockquote><p>还款非大事务，整体流水串联没有事务，每一小步都是单独的事务</p></blockquote><ul><li>无事务操作</li></ul><p>查询账户信息、借据信息、是否日间状态是否可以还款等</p><ul><li>插入流水、日切中的还款锁定账户（临时事务，乐观锁）</li></ul><blockquote><p>开启事务</p></blockquote><div class=table-wrapper><table><thead><tr><th>还款类型</th><th>处理方式</th></tr></thead><tbody><tr><td>非日间还款（非日间的联机还款或批量还款）</td><td>标记为还款待处理、锁定账户、不试算</td></tr><tr><td>诉讼还款</td><td>插入诉讼还款流水</td></tr><tr><td>正常还款</td><td>贷款交易表、贷款交易流水表、支付交易流水表插入初始化流水</td></tr><tr><td>提前还款</td><td>贷款交易表、贷款交易流水表、支付交易流水表插入初始化流水</td></tr></tbody></table></div><p>插入流水扩展信息</p><blockquote><p>事务结束</p></blockquote><p>检测是否在营业窗口，决定是否后续流程（日切过程中直接结束）</p><ul><li>日间的还款锁定账户（乐观锁）</li></ul><p>上方只有在日切过程中会提前锁定账户，直接返回。</p><p>对于其他还款、只插入了流水，现在锁定账户。(借新还旧特殊处理，不锁定账户)</p><ul><li>调用正常还款试算（无事务）</li></ul><p>调用上面提到的正常还款试算，得出还款后的本、利、罚余额等</p><ul><li>调用支付请求还款</li></ul><p>默认账户仍未锁定状态、当支付返回失败才进行解锁操作。</p><blockquote><p>若支付返回处理中，仍未锁定状态，等待后续流水批量状态同步再判断是否解锁。</p></blockquote><h4 id=信贷管理还款取消事务1cansel>信贷管理：还款取消（事务1：cansel）</h4><p>更新还款申请流水和台账历史流水为失败</p><h4 id=信贷核心还款取消事务2cansel>信贷核心：还款取消（事务2：cansel）</h4><blockquote><p>事务开启</p></blockquote><ul><li>根据主流水为失败</li></ul><p>诉讼还款更新诉讼流水为失败</p><ul><li><p>解锁之前锁定的账户（乐观锁解锁）</p></li><li><p>更新支付流水、贷款交易流水为失败</p></li></ul><blockquote><p>事务结束</p></blockquote><h4 id=信贷管理还款确认事务1confirm>信贷管理：还款确认（事务1：confirm）</h4><blockquote><p>若支付返回成功，则进入确认流程</p></blockquote><blockquote><p>开启事务</p></blockquote><ul><li><p>更新还款申请流水、台账流水为成功</p></li><li><p>恢复额度（释放额度）</p></li></ul><p>根据还款本金，恢复额度协议分项表中的额度</p><blockquote><p>若本次还款为代偿还款，记录当前客户被代偿次数+1</p></blockquote><blockquote><p>事务结束</p></blockquote><h4 id=信贷核心正常还款确认事务2confirm>信贷核心：正常还款确认（事务2：confirm）</h4><blockquote><p>开启事务</p></blockquote><ul><li><p>查询还款前借据信息、更新主流水为成功</p></li><li><p>判断是否为最后一笔还款、后续是否可以销户</p></li><li><p>保存老期供信息、新建新的期供，金额为试算时的金额</p></li><li><p>保存老、新建新的借据，更新借据信息</p></li></ul><p>根据老借据状态对借据进行不同处理</p><div class=table-wrapper><table><thead><tr><th>原借据状态</th><th>处理方式</th></tr></thead><tbody><tr><td>核销</td><td>还清：核销销户<br>未还清：更新核销余额</td></tr><tr><td>已减值</td><td>已结清：销户<br>若期供最小到期&lt;交易日期：转正常<br>期供到期日&lt; 交易日期</td></tr><tr><td>逾期还款</td><td>结清：销户<br>还完逾期：借据状态转正常<br>仍为逾期：只扣减金额</td></tr><tr><td>正常还款</td><td>结清：销户<br>正常还款：扣减金额</td></tr></tbody></table></div><ul><li>转正常</li></ul><ol><li>将期供催收金额更新到应收金额</li><li>借据催收金额更新到应收金额</li><li>更新借据扩展信息计息标识</li><li>形态转移表记录本次结转金额</li></ol><ul><li>若本次还款中涉及计提</li></ul><p>记录未记录的计提流水</p><ul><li>判断是否结息</li></ul><p>结息：应计转应收</p><p>记录结息流水</p><p>更新借据信息为已结息</p><ul><li>判断是否红冲</li></ul><p>延展期等可能导致红冲出现</p><p>一般正冲应计</p><p>若已结息则反冲应收</p><ul><li><p>登记减免和交易明细</p></li><li><p>解锁账户表、更新账户状态（可能存在减值转正常或销户等）</p></li><li><p>更新期供金额、状态</p></li></ul><blockquote><p>至此、借据状态、账户状态、期供状态都已修改完毕</p></blockquote><ul><li>确认之前的申请流水</li></ul><p>将之前的支付流水、贷款交易流水置为成功</p><ul><li>保存老数据用于冲正</li></ul><blockquote><p>事务结束</p></blockquote><h4 id=正常还款总结>正常还款总结</h4><h2 id=特别说明>特别说明</h2><h3 id=信贷核心还款锁定说明乐观锁>信贷核心还款锁定说明（乐观锁）</h3><p>客户计提、还款时，为避免多次try导致金额扣减出问题，默认一笔借据同一时间只能有一次还款在处理中。所有在执行扣款、计提中（try阶段）要对客户账户上锁。</p><ul><li>账户上锁的基本原则</li></ul><p>哪条流水（连接/线程）进行的加锁（开启事务/获取资源）操作，有且只有这条流水去进行解锁（提交事务/释放资源），而且必须保证解锁的逻辑能够执行。</p><p>否则可能导致的后果：</p><ol><li>死锁</li><li>锁失效</li><li>事务不生效</li><li>脏资源</li></ol><ul><li>加锁与解锁</li></ul><p>所有借据都有对应的账户数据，账户表中有字段账户处理标识和请求编号字段。</p><div class=table-wrapper><table><thead><tr><th>字段名</th><th>逻辑</th></tr></thead><tbody><tr><td>。。。</td><td></td></tr><tr><td>账户处理标识</td><td>0：已处理<br>1：账户表处理中/临时表未处理</td></tr><tr><td>请求流水号</td><td>当前正在操作账户的流水，只有处理表示为1时才存在请求流水号，当标识为0时不存在请求流水号</td></tr></tbody></table></div><p>加锁</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>update</span><span class=w> </span><span class=err>账户表</span><span class=w> </span><span class=kt>set</span><span class=w> </span><span class=err>处理标识</span><span class=o>=</span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=err>请求流水</span><span class=o>=</span><span class=s1>&#39;当前请求流水&#39;</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=err>借据号</span><span class=o>=</span><span class=s1>&#39;借据号&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=err>处理标识</span><span class=o>=</span><span class=s1>&#39;0&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>更新后检测是否更新成功，如果更新成功。则加锁成功。后续其他流水无法再锁定当前账户</p><p>解锁</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>update</span><span class=w> </span><span class=kt>set</span><span class=w> </span><span class=err>处理标识</span><span class=o>=</span><span class=s1>&#39;0&#39;</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=err>借据号</span><span class=o>=</span><span class=s1>&#39;借据号&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=err>处理标识</span><span class=o>=</span><span class=s1>&#39;1&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=err>请求流水</span><span class=o>=</span><span class=s1>&#39;请求解锁的流水号&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><blockquote><p>解锁只能通过上锁的流水来解锁，保证单笔借据不会重复交易，产生并发问题。</p></blockquote><h2 id=计算器>计算器</h2><h3 id=放款-1>放款</h3><blockquote><p>放款需要的要素：</p><p>还本周期、还息周期、年计息天数、剩余本金、开始日期（借据起始日期）、年利率、总期数（产品配置中存）</p></blockquote><p><strong>还本周期（贷款扣收本金的频率）</strong>：默认为授信时为客户配置，样式：3|M|A|E</p><blockquote><p>周期性字段的解释</p></blockquote><div class=table-wrapper><table><thead><tr><th>3</th><th>M</th><th>A</th><th>E</th></tr></thead><tbody><tr><td>间隔：1,3,12<br>常数，表示每多少后方量做一次循环</td><td>循环量：<br>D:天Daily<br>W:周Weekly<br>S：旬Semi-Monthly<br>M：月Monthly<br>Q：季Quarterly<br>Y：年Yearly<br>一般的配置M或月</td><td>工作日选项：<br>A：实际日期（无视是否工作日）<br>N：下一个工作日（会顺延到下一个工作日）<br>P：上一个工作日（同理）</td><td>日期：<br>E：每次循环的最后一天<br>1到31：满足前面循环的固定日期<br>*满足条件的任意一天</td></tr></tbody></table></div><p>例：</p><ol><li>1|M|A|15 每个月的15日，无视是否工作日</li><li>1|M|A|E 落在每月的最后那天，不管那个月有多少天。1月31日、2月28日、2月29日，3月30日等</li><li>1|Q|A|E 落在每个季度的最后一天，3月31日、6月30日、9月30日、12月31日</li></ol><p><strong>还息周期</strong>：同还本周期</p><h4 id=等额本金计算器>等额本金计算器</h4><blockquote><p>先息后本、等额本金、自定义周期性还本还息</p></blockquote><div class=table-wrapper><table><thead><tr><th>需要生成的字段</th><th>逻辑</th></tr></thead><tbody><tr><td>还息周期</td><td>一般由授信信息得出，授信时会为每位客户定好固定的还息周期。还息周期一般情况为1开头<br>一般还息周期决定了一笔借据一期有多长，默认以还一次息为还一期期供</td></tr><tr><td>还本周期</td><td>等额本金：<strong>等额本金还本周期必须等于还息周期</strong><br>还本周期必须大于等于还息周期，<font color=red>不能存在本金还完后，利息还没有还完的情况</font>。若还息周期*期数小于还本周期，则让还本周期等于最末期（先息后本）</td></tr><tr><td>年计息天数</td><td>产品配置，一般为360或365</td></tr><tr><td>起息日</td><td>贷款的开始日期</td></tr><tr><td>每期应还本金额（理想值）</td><td>每期还本金额的平均值（末期可能不同）<br><strong>需要还本的期数</strong>=总期数*还息周期/还本周期<br>平均还本金额=总金额/需还本期数</td></tr><tr><td>填充本金</td><td>还本周期为还息周期的整数倍关系，先用理想值填充非末期的（i*还本周期/还息周期）本金余额</td></tr><tr><td>末期本金</td><td>末期本金不是直接取平均值，而是通过总金额扣减上面每次填充的本金后的余额。</td></tr><tr><td>首期还款日</td><td>单期借据（只有一期的借据）：Math.min(次月的今天,次月的最后一天)<br>理想情况：为下一个月的放款日<br>破期（需要向下一个周期推演）：3月10日推迟到4月10日</td></tr><tr><td>首期计息天数</td><td>只针对破期的情况：<br>1、按实际天数计算<br>2、按整期计算<br>3、按照30天+零头计算</td></tr><tr><td>首期利息</td><td>剩余本金*年利率*计息天数/年计息天数</td></tr><tr><td>其他期数</td><td>其他期数按照第一确定的还款日向后推演</td></tr></tbody></table></div><h4 id=等额本息计算器>等额本息计算器</h4><blockquote><p>还息周期必须等于还本周期（房贷最常用的还款方式）</p><p>起始日期与结束日期都为固定值，一般不存在破期</p></blockquote><div class=table-wrapper><table><thead><tr><th>字段</th><th>取值逻辑</th></tr></thead><tbody><tr><td>每期还款金额（本息和）</td><td>放款金额*年利率*（1+年利率）的总期次数量方/（（1+年利率）的总其次数量方-1）<br>本金.multiply(rate)multiply(Math.pow(1+rate,总期数)).divide(Math.pow(1+rate,总期数)-1)</td></tr><tr><td>利息</td><td>剩余本金*利率*计息天数/年计息天数</td></tr><tr><td>本金</td><td>每期还款金额-利息金额</td></tr></tbody></table></div><blockquote><p>为什么这么计算每期还款金额？</p></blockquote><p>对于每一期的利息，一定是按照当期剩余本金*利率来算息，+1之后可以确定本息和。n次幂-1表示一共需要计算了n次幂的利息，则还款金额刚好等于总金额/n次幂-1</p><p><img src=https://fastly.jsdelivr.net/gh/thecoolboyhan/th_blogs@main/image/2025-07/250701195852848_1751371132891.png loading=lazy alt=250701195852848.png></p><h2 id=批量还款>批量还款</h2><h3 id=批量还款准备>批量还款准备</h3><ol><li>清理数据，删除批量临时表(分库)、删除绑卡信息临时表</li></ol><blockquote><p>可以被批扣的租户保存在临时表中</p></blockquote><ol start=2><li>待还款数据初始化</li></ol><p>将账户表、借据表中有自动还款标识的数据搬入临时表</p><blockquote><p>如果已经做代偿的数据不进入批量扣款</p></blockquote><h3 id=自营批量还款幂等>自营批量还款(幂等)</h3><p>分布式同时批扣(6台server，6个node,每个机器根据自己的编号取模后决定是否执行)<strong>由于是分片广播，所有机器默认会收到所有通知，但不是每个通知都要处理，只有对应自己的机器才执行</strong></p><p>创建线程池(可配置线程数)</p><p>开始线程池内部循环任务:按照客户为维度扣款</p><ol><li><p>获取当前客户的绑卡卡信息</p></li><li><p>拷贝当前客户名下的所有借据list1</p></li><li><p>外层循环卡信息、内层循环借据信息，逐笔对当前借据进行应还款试算</p></li><li><p>根据试算结果，调用正常还款流程</p></li><li><p>失败场景：</p><ol><li>返回结果还款失败，正常记录失败。</li><li>如果出现I0异常(网络请求异常)，也当失败处理，记录结果为失败。</li></ol></li><li><p>成功：记录成功结果，并记录本次还款金额。</p></li></ol><blockquote><p>上面的结果，需携带当前是否出现卡余额不足情况，如果出现余额不足，则跳出当前卡循环，进入下一张卡</p></blockquote><ol start=7><li>当前借据全部扣款完成，修改临时list1状态为成功，借据状态为结清(添加如成功集合，下次循环不再处理)</li><li>未结清的借据保持处理中不变，交易状态标记为未结清，下次循环继续扣款。</li><li>对于支付超时，(处理中)的借据也标记为处理中，且标记为支付处理中，同结清逻辑添加到成功集合，下次循环不再处理</li><li>从贷批扣集合中，去除上面批扣成功的借据，更新当前客户updateTime(更新时间是为了防止一直给同一个客户进行批扣)</li></ol><h2 id=流水状态同步>流水状态同步</h2><h3 id=自营流水状态同步>自营流水状态同步</h3><blockquote><p>每两分钟执行一次，同步所有交易流水,尽量让为完成的事务走向终态。(最大努力交付)<strong>流水同步需跳过日切时段</strong></p></blockquote><p>1、圈定处理数据范围，获取批扣，或主流水表中执行状态为处理中的流水。</p><blockquote><p>根据主流水范围，单笔执行</p></blockquote><p>2、根据流水状态为处理中的流水，查询支付返回的处理结果</p><blockquote><p><strong>下面内容为处理模板，对于不同的流水会进行不同的处理实现</strong></p></blockquote><ol><li>前置校验:判断是否满足执行</li><li>查询支付流水状态:获取结果</li><li>判断当前是否是日切状态:如果日切，不进行流水同步</li><li>开启独立事务，执行流水状态同步</li></ol><blockquote><p>后面的几种流水全部按照上述模板执行，主要展示前置校验和执行流水同步的逻辑</p></blockquote><h4 id=虚账户提现或红包提现的流水同步>虚账户提现或红包提现的流水同步</h4><ul><li>前置判断</li></ul><p>无需进行前置判断，虚账户和红包提现没有账户信息和账务交易流水。(默认可以执行)</p><ul><li>处理逻辑</li></ul><p>直接更新主流水表，由于没有账户信息，不需要上锁或解锁</p><h4 id=放款流水同步>放款流水同步</h4><ul><li>前置判断</li></ul><p>对于放款冲正的流水，需修改前流水状态为已冲正(由于借据已经被冲正，不需要进行解锁）</p><blockquote><p>更新贷款流水，更新主流水，更新支付流水为失败</p></blockquote><p>非冲正流水可执行具体同步逻辑</p><ul><li>同步逻辑</li></ul><ol><li><p>支付状态仍为处理中:只增加同步计数，不做其他处理return</p></li><li><p><strong>有结果的数据，先更新三大流水</strong>：更新贷款流水，更新主流水，更新支付流水</p></li><li><p><strong>解锁</strong>:修改账户表到终态</p></li><li><p><strong>对于成功的流水进行后续补偿</strong>：计税、对于银行核心模式,借据和期供信息来自对方需同步借据信息和期供信息)、发送核算报文(让核算系统记账)、累加头寸(头寸为了汇总每日放款还款等信息勾兑)</p></li><li><p><strong>给信贷中台发送成功mg</strong>，让其做后续处理(可能需处理营销、客户信息、短信等各种自定义流水，但其与账务无关，这里不再赘述)</p></li></ol><h4 id=还款流水同步>还款流水同步</h4><ul><li>前置判断</li></ul><p>还款流水必须是主流水表中存在流水才能执行(防止出现意料外的流水)</p><ul><li>同步逻辑</li></ul><ol><li>类似放款，如果支付同步的流水仍未处理中，则增加同步计数，return(但批扣需特殊处理，批扣会先将数据存放如临时表中，不断无限循环，为了防止死循环，会先把这次临时表状态修改为失败<strong>这里的失败不是让批扣失败，是让批扣不再重试</strong>)</li><li>对于成功的流水，重新调用提前还款或正常还款:走试算、还款流程来记账。(只是本次不涉及调用支付场景)且提交TCC事务。(直接提交，本次也不存在占用失败，取消等场景）</li><li>对于失败的流水，更新流水状态为失败，解锁账户。</li><li>与放款相同，发送还款后mg，执行后续处理。</li></ol><h3 id=合作方放款流水同步>合作方放款流水同步</h3><ol><li>获取合作方的放款流水(获取条件为上一步中所有状态为处理中的用户）</li><li>根据合作方的结果根据当前流水到终态（成功或者失败）</li></ol><blockquote><p>注:只更新了流水</p></blockquote><h3 id=合作方还款流水同步>合作方还款流水同步</h3><ol><li>查询流水状态为处理中的流水</li><li>通过springcontextHolder.getBean(单笔还款流水查询.class)开启独立新事务执行单笔流水处理</li><li>根据合作方的还款流水，单笔修改流水状态为成功、失败或处理中</li></ol></section><footer class=article-footer><section class=article-tags><a href=/tags/%E4%B8%9A%E5%8A%A1/>业务</a>
<a href=/tags/%E9%9A%8F%E7%AC%94/>随笔</a>
<a href=/tags/%E8%B4%A6%E5%8A%A1/>账务</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/p/%E8%B4%A6%E5%8A%A1%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84/><div class=article-image><img src=/1.png loading=lazy data-key data-hash=/1.png></div><div class=article-details><h2 class=article-title>账务是怎样运行的</h2></div></a></article><article class=has-image><a href=/p/%E8%9A%82%E8%9A%81%E7%B3%BB%E8%B4%A6%E5%8A%A1%E6%96%87%E4%BB%B6%E7%90%86%E8%A7%A3/><div class=article-image><img src=/p/%E8%9A%82%E8%9A%81%E7%B3%BB%E8%B4%A6%E5%8A%A1%E6%96%87%E4%BB%B6%E7%90%86%E8%A7%A3/mayi.05114a43f00f07bd6e862c336fcbae6d_hu_e05e2794f77d0547.png width=250 height=150 loading=lazy alt="Featured image of post 蚂蚁系账务文件理解" data-hash="md5-BRFKQ/APB71uhiwzb8uubQ=="></div><div class=article-details><h2 class=article-title>蚂蚁系账务文件理解</h2></div></a></article><article class=has-image><a href=/p/%E7%AE%97%E6%B3%95-%E6%8E%92%E5%BA%8F/><div class=article-image><img src=/p/%E7%AE%97%E6%B3%95-%E6%8E%92%E5%BA%8F/1.6b1fbb1c4ff2e8a31490db266775c576_hu_6b04be0731fa8bed.png width=250 height=150 loading=lazy alt="Featured image of post 算法-排序" data-hash="md5-ax+7HE/y6KMUkNsmZ3XFdg=="></div><div class=article-details><h2 class=article-title>算法-排序</h2></div></a></article><article class=has-image><a href=/p/rpc%E5%92%8C%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%80%E8%87%B4%E6%80%A7%E5%8D%8F%E8%AE%AE/><div class=article-image><img src=/p/rpc%E5%92%8C%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%80%E8%87%B4%E6%80%A7%E5%8D%8F%E8%AE%AE/1.ec4e9c0e1d8739d0541a0491b3409ee9_hu_84a50323b4d92567.png width=250 height=150 loading=lazy alt="Featured image of post RPC和分布式一致性协议" data-hash="md5-7E6cDh2HOdBUGgSRs0Ce6Q=="></div><div class=article-details><h2 class=article-title>RPC和分布式一致性协议</h2></div></a></article><article class=has-image><a href=/p/%E7%BA%BF%E6%AE%B5%E6%A0%91%E9%A2%98%E9%9B%86%E4%B8%8E%E5%88%86%E6%9E%90/><div class=article-image><img src=/p/%E7%BA%BF%E6%AE%B5%E6%A0%91%E9%A2%98%E9%9B%86%E4%B8%8E%E5%88%86%E6%9E%90/2025-03-17.a136d6ba92bfe7b1c36785c693153327_hu_7632048e901617b3.png width=250 height=150 loading=lazy alt="Featured image of post 线段树题集与分析" data-hash="md5-oTbWupK/57HDZ4XGkxUzJw=="></div><div class=article-details><h2 class=article-title>线段树题集与分析</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//thecoolboyhan.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2026 韩永发的博客</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.33.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.c922af694cc257bf1ecc41c0dd7b0430f9114ec280ccf67cd2c6ad55f5316c4e.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>